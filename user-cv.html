<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Qu·∫£n L√Ω CV - HRM System</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- Navigation -->
    <nav class="nav">
      <div class="container nav-container">
        <a href="index.html" class="nav-logo">HRM</a>
        <ul class="nav-menu">
          <li><a href="index.html" class="nav-link">Trang ch·ªß</a></li>
          <li><a href="user-dashboard.html" class="nav-link">Dashboard</a></li>
          <li><a href="user-profile.html" class="nav-link">H·ªì s∆°</a></li>
          <li><a href="user-cv.html" class="nav-link active">CV</a></li>
          <li>
            <a href="user-qualifications.html" class="nav-link">Tr√¨nh ƒë·ªô</a>
          </li>
          <li><a href="#" class="nav-link" onclick="logout()">ƒêƒÉng xu·∫•t</a></li>
        </ul>
      </div>
    </nav>

    <!-- CV Content -->
    <div class="dashboard-container">
      <div class="container" style="padding-top: 48px; padding-bottom: 48px">
        <h1 class="mb-4">QU·∫¢N L√ù CV</h1>

        <div class="grid grid-2">
          <!-- Upload Area -->
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">T·∫¢I L√äN CV M·ªöI</h3>
            </div>
            <div class="card-body">
              <div class="upload-zone" id="uploadZone">
                <div class="upload-icon">üìÅ</div>
                <h4>K√©o th·∫£ file v√†o ƒë√¢y</h4>
                <p>ho·∫∑c</p>
                <input
                  type="file"
                  id="fileInput"
                  accept=".pdf,.doc,.docx"
                  style="display: none"
                />
                <button
                  class="btn btn-outline"
                  onclick="document.getElementById('fileInput').click()"
                >
                  Ch·ªçn file
                </button>
                <p class="upload-hint">
                  Ch·∫•p nh·∫≠n: PDF, DOC, DOCX (T·ªëi ƒëa 5MB)
                </p>
              </div>
              <div
                id="uploadProgress"
                class="upload-progress"
                style="display: none"
              >
                <div class="progress-bar">
                  <div
                    class="progress-fill"
                    id="progressFill"
                    style="width: 0%"
                  ></div>
                </div>
                <p class="text-center mt-2" id="progressText">
                  ƒêang t·∫£i l√™n...
                </p>
              </div>
            </div>
          </div>

          <!-- Auto Generate CV -->
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">T·ª∞ ƒê·ªòNG T·∫†O CV</h3>
            </div>
            <div class="card-body">
              <p class="mb-3">
                H·ªá th·ªëng c√≥ th·ªÉ t·ª± ƒë·ªông t·∫°o CV t·ª´ d·ªØ li·ªáu h·ªì s∆° c·ªßa b·∫°n
              </p>
              <div class="flex flex-col gap-2">
                <button
                  class="btn btn-outline"
                  onclick="alert('Ch·ª©c nƒÉng ƒëang ph√°t tri·ªÉn')"
                >
                  T·∫°o CV t·ª´ h·ªá th·ªëng
                </button>
                <button
                  class="btn btn-outline"
                  onclick="alert('Ch·ª©c nƒÉng ƒëang ph√°t tri·ªÉn')"
                >
                  Ch·ªçn m·∫´u CV
                </button>
                <button
                  class="btn btn-outline"
                  onclick="alert('Ch·ª©c nƒÉng ƒëang ph√°t tri·ªÉn')"
                >
                  Xem tr∆∞·ªõc CV
                </button>
              </div>

              <div class="mt-4 p-3 bg-gray">
                <h5 class="font-heading mb-2">M·∫™U CV C√ì S·∫¥N:</h5>
                <ul class="feature-list" style="font-size: 0.875rem">
                  <li>CV Chu·∫©n Bauhaus</li>
                  <li>CV T·ªëi Gi·∫£n</li>
                  <li>CV Chuy√™n Nghi·ªáp</li>
                  <li>CV S√°ng T·∫°o</li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <!-- CV History -->
        <div class="card mt-4">
          <div class="card-header">
            <h3 class="card-title">L·ªäCH S·ª¨ PHI√äN B·∫¢N CV</h3>
          </div>
          <div class="card-body">
            <div class="table-container">
              <table class="table" id="cvTable">
                <thead>
                  <tr>
                    <th>Phi√™n b·∫£n</th>
                    <th>T√™n file</th>
                    <th>Ng√†y t·∫£i l√™n</th>
                    <th>K√≠ch th∆∞·ªõc</th>
                    <th>Tr·∫°ng th√°i</th>
                    <th>Thao t√°c</th>
                  </tr>
                </thead>
                <tbody id="cvTableBody">
                  <!-- CV list will be loaded here -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <style>
      .dashboard-container {
        background: var(--color-gray-100);
        min-height: 100vh;
      }

      .upload-zone {
        border: 3px dashed var(--color-gray-400);
        padding: var(--space-6);
        text-align: center;
        transition: all var(--transition-base);
        cursor: pointer;
      }

      .upload-zone:hover {
        border-color: var(--color-black);
        background: var(--color-gray-100);
      }

      .upload-zone.drag-over {
        border-color: var(--color-red);
        background: var(--color-gray-100);
      }

      .upload-icon {
        font-size: 4rem;
        margin-bottom: var(--space-2);
      }

      .upload-hint {
        font-size: 0.875rem;
        color: var(--color-gray-700);
        margin-top: var(--space-2);
      }

      .upload-progress {
        padding: var(--space-3);
      }

      .cv-actions {
        display: flex;
        gap: var(--space-1);
      }

      .cv-actions button {
        padding: 4px 8px;
        font-size: 0.75rem;
      }
    </style>

    <script src="js/data.js"></script>
    <script src="js/app.js"></script>
    <script>
      requireAuth();

      // Initialize drag & drop
      const uploadZone = document.getElementById("uploadZone");
      const fileInput = document.getElementById("fileInput");

      ["dragenter", "dragover", "dragleave", "drop"].forEach((eventName) => {
        uploadZone.addEventListener(eventName, preventDefaults, false);
      });

      function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
      }

      ["dragenter", "dragover"].forEach((eventName) => {
        uploadZone.addEventListener(eventName, () => {
          uploadZone.classList.add("drag-over");
        });
      });

      ["dragleave", "drop"].forEach((eventName) => {
        uploadZone.addEventListener(eventName, () => {
          uploadZone.classList.remove("drag-over");
        });
      });

      uploadZone.addEventListener("drop", (e) => {
        const files = e.dataTransfer.files;
        handleFiles(files);
      });

      fileInput.addEventListener("change", (e) => {
        handleFiles(e.target.files);
      });

      function handleFiles(files) {
        if (files.length === 0) return;

        const file = files[0];
        const validTypes = [
          "application/pdf",
          "application/msword",
          "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
        ];

        if (!validTypes.includes(file.type)) {
          showToast("Ch·ªâ ch·∫•p nh·∫≠n file PDF, DOC, DOCX", "error");
          return;
        }

        if (file.size > 5 * 1024 * 1024) {
          showToast("File kh√¥ng ƒë∆∞·ª£c v∆∞·ª£t qu√° 5MB", "error");
          return;
        }

        uploadFile(file);
      }

      function uploadFile(file) {
        const uploadProgress = document.getElementById("uploadProgress");
        const progressFill = document.getElementById("progressFill");
        const progressText = document.getElementById("progressText");

        uploadProgress.style.display = "block";
        uploadZone.style.display = "none";

        // Simulate upload progress
        let progress = 0;
        const interval = setInterval(() => {
          progress += 10;
          progressFill.style.width = progress + "%";
          progressText.textContent = `ƒêang t·∫£i l√™n... ${progress}%`;

          if (progress >= 100) {
            clearInterval(interval);
            setTimeout(() => {
              showToast("T·∫£i l√™n CV th√†nh c√¥ng!", "success");
              uploadProgress.style.display = "none";
              uploadZone.style.display = "block";
              progressFill.style.width = "0%";
              loadCVList();
            }, 500);
          }
        }, 200);
      }

      function loadCVList() {
        const tbody = document.getElementById("cvTableBody");
        const cvData = [
          {
            version: "2.0",
            fileName: "CV_NguyenVanAn_v2.pdf",
            uploadDate: "2026-01-12",
            size: "2.5 MB",
            status: "Hi·ªán t·∫°i",
          },
          {
            version: "1.0",
            fileName: "CV_NguyenVanAn_v1.pdf",
            uploadDate: "2025-06-20",
            size: "2.3 MB",
            status: "C≈©",
          },
        ];

        tbody.innerHTML = cvData
          .map(
            (cv, index) => `
                <tr>
                    <td class="code">${cv.version}</td>
                    <td>${cv.fileName}</td>
                    <td>${formatDate(cv.uploadDate)}</td>
                    <td>${cv.size}</td>
                    <td>
                        <span class="badge ${
                          cv.status === "Hi·ªán t·∫°i" ? "badge-red" : "badge-gray"
                        }">${cv.status}</span>
                    </td>
                    <td class="cv-actions">
                        <button class="btn btn-small btn-outline" onclick="viewCV(${index})">Xem</button>
                        <button class="btn btn-small btn-outline" onclick="downloadCV(${index})">T·∫£i</button>
                        ${
                          cv.status !== "Hi·ªán t·∫°i"
                            ? '<button class="btn btn-small btn-outline" onclick="deleteCV(' +
                              index +
                              ')">X√≥a</button>'
                            : ""
                        }
                    </td>
                </tr>
            `
          )
          .join("");
      }

      function viewCV(index) {
        showToast("ƒêang m·ªü CV...", "info");
        setTimeout(() => {
          alert("Ch·ª©c nƒÉng xem CV ƒëang ph√°t tri·ªÉn");
        }, 500);
      }

      function downloadCV(index) {
        showToast("ƒêang t·∫£i xu·ªëng...", "info");
        setTimeout(() => {
          showToast("T·∫£i xu·ªëng th√†nh c√¥ng!", "success");
        }, 1000);
      }

      function deleteCV(index) {
        if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a phi√™n b·∫£n CV n√†y?")) {
          showToast("ƒê√£ x√≥a CV", "success");
          loadCVList();
        }
      }

      // Load CV list on page load
      document.addEventListener("DOMContentLoaded", () => {
        loadCVList();
      });
    </script>
  </body>
</html>
