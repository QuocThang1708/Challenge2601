<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tr√¨nh ƒê·ªô & H·ªçc V·∫•n - HRM</title>
    <link rel="stylesheet" href="../shared/styles.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>
  <body>
    <!-- APP LAYOUT -->
    <div class="app-layout">
      <!-- SIDEBAR -->
      <aside class="sidebar" aria-label="Main Navigation">
        <div class="sidebar-header">
          <img src="../shared/logo.png" alt="Logo" />
          <div class="logo-text">
            <span style="display: block; font-size: 1.1rem; font-weight: 800"
              >C·ªîNG C√ÅN B·ªò</span
            >
            <span
              style="
                display: block;
                font-size: 0.8rem;
                font-weight: 500;
                color: #94a3b8;
              "
              >HRM SYSTEM</span
            >
          </div>
        </div>

        <nav class="sidebar-nav">
          <a href="dashboard.html" class="nav-item">
            <i class="fas fa-home"></i> Dashboard
          </a>
          <a href="profile.html" class="nav-item">
            <i class="fas fa-user"></i> H·ªì s∆° c√° nh√¢n
          </a>
          <a href="cv.html" class="nav-item">
            <i class="fas fa-file-alt"></i> Qu·∫£n l√Ω CV
          </a>
          <a
            href="qualifications.html"
            class="nav-item active"
            aria-current="page"
          >
            <i class="fas fa-graduation-cap"></i> Tr√¨nh ƒë·ªô & B·∫±ng c·∫•p
          </a>
        </nav>
      </aside>

      <!-- MAIN CONTENT -->
      <main class="main-content" role="main">
        <!-- TOPBAR -->
        <header class="topbar">
          <h2 class="page-title">Tr√¨nh ƒë·ªô & B·∫±ng c·∫•p</h2>
          <div class="user-profile">
            <button
              onclick="logout()"
              class="btn btn-icon btn-outline"
              title="ƒêƒÉng xu·∫•t"
            >
              <i class="fas fa-sign-out-alt"></i>
            </button>
          </div>
        </header>

        <!-- CONTENT WRAPPER -->
        <div class="content-wrapper">
          <div class="flex items-center gap-3 mb-4">
            <!-- <button
              onclick="window.history.back()"
              class="btn btn-outline btn-icon"
              aria-label="Quay l·∫°i"
            >
              <i class="fas fa-arrow-left"></i>
            </button> -->
            <h1 style="margin: 0; font-size: 1.75rem">TR√åNH ƒê·ªò & H·ªåC V·∫§N</h1>
          </div>

          <!-- Education Section -->
          <div class="card mb-4">
            <div class="card-header">
              <div class="flex justify-between items-center">
                <h3 class="card-title">H·ªåC V·∫§N</h3>
                <button
                  class="btn btn-primary"
                  onclick="showModal('addEducationModal')"
                >
                  <i class="fas fa-plus"></i> Th√™m
                </button>
              </div>
            </div>
            <div class="card-body">
              <div class="timeline" id="educationTimeline">
                <div
                  style="
                    text-align: center;
                    padding: var(--space-4);
                    color: var(--color-gray-700);
                  "
                >
                  Ch∆∞a c√≥ th√¥ng tin h·ªçc v·∫•n. Click "Th√™m" ƒë·ªÉ b·∫Øt ƒë·∫ßu!
                </div>
              </div>
            </div>
          </div>

          <!-- Experience Section -->
          <div class="card mb-4">
            <div class="card-header">
              <div class="flex justify-between items-center">
                <h3 class="card-title">KINH NGHI·ªÜM C√îNG T√ÅC</h3>
                <button
                  class="btn btn-primary"
                  onclick="showModal('addExperienceModal')"
                >
                  <i class="fas fa-plus"></i> Th√™m
                </button>
              </div>
            </div>
            <div class="card-body">
              <div class="timeline" id="experienceTimeline">
                <div
                  style="
                    text-align: center;
                    padding: var(--space-4);
                    color: var(--color-gray-700);
                  "
                >
                  Ch∆∞a c√≥ kinh nghi·ªám c√¥ng t√°c. Click "Th√™m" ƒë·ªÉ b·∫Øt ƒë·∫ßu!
                </div>
              </div>
            </div>
          </div>

          <!-- Skills Section -->
          <div class="card mb-4">
            <div class="card-header">
              <div class="flex justify-between items-center">
                <h3 class="card-title">K·ª∏ NƒÇNG</h3>
                <button
                  class="btn btn-primary"
                  onclick="showModal('addSkillModal')"
                >
                  <i class="fas fa-plus"></i> Th√™m
                </button>
              </div>
            </div>
            <div class="card-body">
              <div id="skillsList">
                <div
                  style="
                    text-align: center;
                    padding: var(--space-4);
                    color: var(--color-gray-700);
                  "
                >
                  Ch∆∞a c√≥ k·ªπ nƒÉng n√†o. Click "Th√™m" ƒë·ªÉ b·∫Øt ƒë·∫ßu!
                </div>
              </div>
            </div>
          </div>

          <!-- Achievements Section -->
          <div class="card">
            <div class="card-header">
              <div class="flex justify-between items-center">
                <h3 class="card-title">TH√ÄNH T√çCH & KHEN TH∆Ø·ªûNG</h3>
                <button
                  class="btn btn-primary"
                  onclick="showModal('addAchievementModal')"
                >
                  <i class="fas fa-plus"></i> Th√™m
                </button>
              </div>
            </div>
            <div class="card-body">
              <div id="achievementsList">
                <div
                  style="
                    text-align: center;
                    padding: var(--space-4);
                    color: var(--color-gray-700);
                  "
                >
                  Ch∆∞a c√≥ th√†nh t√≠ch n√†o. Click "Th√™m" ƒë·ªÉ b·∫Øt ƒë·∫ßu!
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Modals remain unchanged below, but conceptually they are children of body/layout now. 
         Ideally, they should be placed outside app-layout or at the end of body.
         Since I'm replacing lines 10-168, and the existing modals start at line 171, this tool call will insert the layout logic and close it properly.
    -->

    <!-- View Detail Modal -->
    <div class="modal-overlay" id="viewDetailModal">
      <div class="modal">
        <div class="modal-header">
          <h2 class="modal-title" id="detailModalTitle">CHI TI·∫æT</h2>
          <button class="modal-close" onclick="closeModal('viewDetailModal')">
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="18" y1="6" x2="6" y2="18" />
              <line x1="6" y1="6" x2="18" y2="18" />
            </svg>
          </button>
        </div>
        <div class="modal-body" id="detailModalBody">
          <!-- Content will be injected here -->
        </div>
        <div class="modal-footer" style="justify-content: space-between">
          <div style="display: flex; gap: var(--space-2)">
            <button class="btn btn-primary" onclick="handleEditFromDetail()">
              Ch·ªânh s·ª≠a
            </button>
            <button
              class="btn btn-outline"
              onclick="handleDeleteFromDetail()"
              style="color: var(--color-red); border-color: var(--color-red)"
            >
              X√≥a
            </button>
          </div>
          <button
            class="btn btn-outline"
            onclick="closeModal('viewDetailModal')"
          >
            ƒê√≥ng
          </button>
        </div>
      </div>
    </div>

    <!-- Add Education Modal -->
    <div class="modal-overlay" id="addEducationModal">
      <div class="modal">
        <div class="modal-header">
          <h2 class="modal-title">TH√äM H·ªåC V·∫§N</h2>
          <button class="modal-close" onclick="closeModal('addEducationModal')">
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="18" y1="6" x2="6" y2="18" />
              <line x1="6" y1="6" x2="18" y2="18" />
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <form
            id="educationForm"
            onsubmit="handleAddEducation(event)"
            novalidate
          >
            <div class="form-group">
              <label class="form-label" for="eduSchool"
                >Tr∆∞·ªùng/C∆° s·ªü ƒë√†o t·∫°o *</label
              >
              <input type="text" id="eduSchool" class="form-input" required />
              <div class="form-error-message" id="error-eduSchool"></div>
            </div>
            <div class="form-group">
              <label class="form-label" for="eduDegree"
                >B·∫±ng c·∫•p/Ch·ª©ng ch·ªâ *</label
              >
              <input type="text" id="eduDegree" class="form-input" required />
              <div class="form-error-message" id="error-eduDegree"></div>
            </div>
            <div class="grid grid-2 gap-3">
              <div class="form-group">
                <label class="form-label" for="eduStartYear"
                  >NƒÉm b·∫Øt ƒë·∫ßu *</label
                >
                <input
                  type="number"
                  id="eduStartYear"
                  class="form-input"
                  required
                  min="1950"
                  max="2030"
                />
                <div class="form-error-message" id="error-eduStartYear"></div>
              </div>
              <div class="form-group">
                <label class="form-label" for="eduEndYear">NƒÉm k·∫øt th√∫c</label>
                <input
                  type="number"
                  id="eduEndYear"
                  class="form-input"
                  min="1950"
                  max="2030"
                />
              </div>
            </div>
            <div class="form-group">
              <label class="form-label" for="eduDescription">M√¥ t·∫£</label>
              <textarea
                id="eduDescription"
                class="form-input"
                rows="3"
              ></textarea>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-outline"
                onclick="closeModal('addEducationModal')"
              >
                H·ªßy
              </button>
              <button type="submit" class="btn btn-primary">Th√™m</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Add Experience Modal -->
    <div class="modal-overlay" id="addExperienceModal">
      <div class="modal">
        <div class="modal-header">
          <h2 class="modal-title">TH√äM KINH NGHI·ªÜM</h2>
          <button
            class="modal-close"
            onclick="closeModal('addExperienceModal')"
          >
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="18" y1="6" x2="6" y2="18" />
              <line x1="6" y1="6" x2="18" y2="18" />
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <form
            id="experienceForm"
            onsubmit="handleAddExperience(event)"
            novalidate
          >
            <div class="form-group">
              <label class="form-label" for="expCompany"
                >C√¥ng ty/T·ªï ch·ª©c *</label
              >
              <input type="text" id="expCompany" class="form-input" required />
              <div class="form-error-message" id="error-expCompany"></div>
            </div>
            <div class="form-group">
              <label class="form-label" for="expPosition">V·ªã tr√≠ *</label>
              <input type="text" id="expPosition" class="form-input" required />
              <div class="form-error-message" id="error-expPosition"></div>
            </div>
            <div class="grid grid-2 gap-3">
              <div class="form-group">
                <label class="form-label" for="expStartDate">T·ª´ nƒÉm *</label>
                <input
                  type="number"
                  id="expStartDate"
                  class="form-input"
                  required
                  min="1950"
                  max="2030"
                />
                <div class="form-error-message" id="error-expStartDate"></div>
              </div>
              <div class="form-group">
                <label class="form-label" for="expEndDate">ƒê·∫øn nƒÉm</label>
                <input
                  type="number"
                  id="expEndDate"
                  class="form-input"
                  min="1950"
                  max="2030"
                  placeholder="Hi·ªán t·∫°i"
                />
              </div>
            </div>
            <div class="form-group">
              <label class="form-label" for="expDescription"
                >M√¥ t·∫£ c√¥ng vi·ªác</label
              >
              <textarea
                id="expDescription"
                class="form-input"
                rows="3"
              ></textarea>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-outline"
                onclick="closeModal('addExperienceModal')"
              >
                H·ªßy
              </button>
              <button type="submit" class="btn btn-primary">Th√™m</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Add Skill Modal -->
    <div class="modal-overlay" id="addSkillModal">
      <div class="modal">
        <div class="modal-header">
          <h2 class="modal-title">TH√äM K·ª∏ NƒÇNG</h2>
          <button class="modal-close" onclick="closeModal('addSkillModal')">
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="18" y1="6" x2="6" y2="18" />
              <line x1="6" y1="6" x2="18" y2="18" />
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <form id="skillForm" onsubmit="handleAddSkill(event)" novalidate>
            <div class="form-group">
              <label class="form-label" for="skillName">T√™n k·ªπ nƒÉng *</label>
              <input type="text" id="skillName" class="form-input" required />
              <div class="form-error-message" id="error-skillName"></div>
            </div>
            <div class="form-group">
              <label class="form-label" for="skillLevel"
                >Tr√¨nh ƒë·ªô (1-5) *</label
              >
              <input
                type="range"
                id="skillLevel"
                min="1"
                max="5"
                value="3"
                oninput="
                  document.getElementById('skillLevelValue').textContent =
                    this.value
                "
              />
              <div style="text-align: center; margin-top: var(--space-1)">
                <span
                  id="skillLevelValue"
                  style="
                    font-family: var(--font-mono);
                    font-size: 1.5rem;
                    font-weight: 700;
                  "
                  >3</span
                >
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-outline"
                onclick="closeModal('addSkillModal')"
              >
                H·ªßy
              </button>
              <button type="submit" class="btn btn-primary">Th√™m</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Add Achievement Modal -->
    <div class="modal-overlay" id="addAchievementModal">
      <div class="modal">
        <div class="modal-header">
          <h2 class="modal-title">TH√äM TH√ÄNH T√çCH</h2>
          <button
            class="modal-close"
            onclick="closeModal('addAchievementModal')"
          >
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="18" y1="6" x2="6" y2="18" />
              <line x1="6" y1="6" x2="18" y2="18" />
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <form
            id="achievementForm"
            onsubmit="handleAddAchievement(event)"
            novalidate
          >
            <div class="form-group">
              <label class="form-label" for="achTitle"
                >Danh hi·ªáu/Gi·∫£i th∆∞·ªüng *</label
              >
              <input type="text" id="achTitle" class="form-input" required />
              <div class="form-error-message" id="error-achTitle"></div>
            </div>
            <div class="form-group">
              <label class="form-label" for="achIssuer">C∆° quan c·∫•p</label>
              <input type="text" id="achIssuer" class="form-input" />
            </div>
            <div class="form-group">
              <label class="form-label" for="achDate">NƒÉm ƒë·∫°t ƒë∆∞·ª£c *</label>
              <input
                type="number"
                id="achDate"
                class="form-input"
                required
                min="1950"
                max="2030"
              />
              <div class="form-error-message" id="error-achDate"></div>
            </div>
            <div class="form-group">
              <label class="form-label" for="achDescription">M√¥ t·∫£</label>
              <textarea
                id="achDescription"
                class="form-input"
                rows="2"
              ></textarea>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-outline"
                onclick="closeModal('addAchievementModal')"
              >
                H·ªßy
              </button>
              <button type="submit" class="btn btn-primary">Th√™m</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <style>
      .dashboard-container {
        background: var(--color-gray-100);
        min-height: 100vh;
      }

      .timeline {
        display: flex;
        flex-direction: column;
        gap: var(--space-3);
      }

      .timeline-item {
        background: var(--color-white);
        border-left: 4px solid var(--color-red);
        padding: var(--space-3);
        transition: all var(--transition-base);
      }

      .timeline-item:hover {
        background: var(--color-gray-100);
        transform: translateX(4px);
      }

      .timeline-title {
        font-family: var(--font-heading);
        font-weight: 700;
        font-size: 1.125rem;
        margin-bottom: var(--space-1);
      }

      .timeline-subtitle {
        color: var(--color-gray-700);
        margin-bottom: var(--space-2);
      }

      .skill-item {
        margin-bottom: var(--space-4);
        padding: var(--space-4);
        background: var(--color-white);
        border: 2px solid var(--color-black);
        border-radius: 8px;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: pointer;
      }

      .skill-item:hover {
        background: #fafafa;
        transform: translateY(-3px);
        box-shadow: 6px 6px 0 var(--color-black);
      }

      .skill-item:hover .skill-bar-fill {
        box-shadow:
          0 0 12px rgba(220, 38, 38, 0.4),
          inset 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .skill-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--space-3);
      }

      .skill-name {
        font-family: var(--font-heading);
        font-weight: 700;
        font-size: 1.15rem;
        color: var(--color-black);
        line-height: 1.3;
      }

      .skill-level-badge {
        font-family: var(--font-mono);
        font-size: 1rem;
        background: transparent;
        color: var(--color-black);
        padding: 0;
        font-weight: 700;
        flex-shrink: 0;
      }

      .skill-bar {
        height: 24px;
        background: #e5e7eb;
        border: 2px solid var(--color-black);
        overflow: hidden;
        position: relative;
        border-radius: 12px;
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.06);
      }

      .skill-bar-fill {
        height: 100%;
        background: linear-gradient(
          135deg,
          #dc2626 0%,
          #ef4444 50%,
          #f87171 100%
        );
        transition:
          width 1s cubic-bezier(0.4, 0, 0.2, 1),
          box-shadow 0.3s;
        position: relative;
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .skill-bar-fill::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 50%;
        background: linear-gradient(
          to bottom,
          rgba(255, 255, 255, 0.3),
          transparent
        );
        border-radius: 12px 12px 0 0;
      }

      .skill-bar-fill::after {
        content: "";
        position: absolute;
        top: 2px;
        left: 4px;
        right: 4px;
        height: 4px;
        background: rgba(255, 255, 255, 0.4);
        border-radius: 4px;
      }
      .achievement-item {
        background: var(--color-white);
        border: 2px solid var(--color-black);
        padding: var(--space-3);
        margin-bottom: var(--space-2);
      }

      .achievement-title {
        font-family: var(--font-heading);
        font-weight: 700;
        font-size: 1.125rem;
        margin-bottom: var(--space-1);
      }

      input[type="range"] {
        width: 100%;
        height: 8px;
        background: var(--color-gray-100);
        border: 2px solid var(--color-black);
        outline: none;
      }

      input[type="range"]::-webkit-slider-thumb {
        width: 20px;
        height: 20px;
        background: var(--color-red);
        cursor: pointer;
        border: 2px solid var(--color-black);
      }
    </style>

    <script src="js/api.js"></script>
    <script src="js/app.js"></script>
    <script>
      requireAuth();

      let qualificationsData = {
        education: [],
        experience: [],
        skills: [],
        achievements: [],
      };

      document.addEventListener("DOMContentLoaded", async () => {
        await loadQualifications();
      });

      async function loadQualifications() {
        try {
          const data = await apiCall("/qualifications");
          qualificationsData = data.data || {
            education: [],
            experience: [],
            skills: [],
            achievements: [],
          };

          renderEducation();
          renderExperience();
          renderSkills();
          renderAchievements();
        } catch (error) {
          console.error("Load qualifications error:", error);
        }
      }

      function renderEducation() {
        const container = document.getElementById("educationTimeline");
        const items = qualificationsData.education || [];

        if (items.length === 0) {
          container.innerHTML =
            '<div style="text-align: center; padding: var(--space-4); color: var(--color-gray-700);">Ch∆∞a c√≥ th√¥ng tin h·ªçc v·∫•n. Click "Th√™m" ƒë·ªÉ b·∫Øt ƒë·∫ßu!</div>';
          return;
        }

        container.innerHTML = items
          .map(
            (item, index) => `
                <div class="timeline-item" onclick="viewEducationDetail(${index})" style="cursor: pointer;">
                    <div class="timeline-title">${item.degree}</div>
                    <div class="timeline-subtitle">${item.school} ‚Ä¢ ${
                      item.startYear
                    } - ${item.endYear || "Hi·ªán t·∫°i"}</div>
                    ${
                      item.description
                        ? `<p style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${item.description}</p>`
                        : ""
                    }
                </div>
            `
          )
          .join("");
      }

      function renderExperience() {
        const container = document.getElementById("experienceTimeline");
        const items = qualificationsData.experience || [];

        if (items.length === 0) {
          container.innerHTML =
            '<div style="text-align: center; padding: var(--space-4); color: var(--color-gray-700);">Ch∆∞a c√≥ kinh nghi·ªám c√¥ng t√°c. Click "Th√™m" ƒë·ªÉ b·∫Øt ƒë·∫ßu!</div>';
          return;
        }

        container.innerHTML = items
          .map(
            (item, index) => `
                <div class="timeline-item" onclick="viewExperienceDetail(${index})" style="cursor: pointer;">
                    <div class="timeline-title">${item.position}</div>
                    <div class="timeline-subtitle">${item.company} ‚Ä¢ ${
                      item.startDate
                    } - ${item.endDate || "Hi·ªán t·∫°i"}</div>
                    ${
                      item.description
                        ? `<p style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${item.description}</p>`
                        : ""
                    }
                </div>
            `
          )
          .join("");
      }

      function renderSkills() {
        const container = document.getElementById("skillsList");
        const items = qualificationsData.skills || [];

        if (items.length === 0) {
          container.innerHTML =
            '<div style="text-align: center; padding: var(--space-4); color: var(--color-gray-700);">Ch∆∞a c√≥ k·ªπ nƒÉng n√†o. Click "Th√™m" ƒë·ªÉ b·∫Øt ƒë·∫ßu!</div>';
          return;
        }

        container.innerHTML = items
          .map(
            (item, index) => `
                <div class="skill-item" onclick="viewSkillDetail(${index})">
                    <div class="skill-header">
                        <div class="skill-name">${item.name}</div>
                        <span class="skill-level-badge">${item.level}/5</span>
                    </div>
                    <div class="skill-bar">
                        <div class="skill-bar-fill" style="width: ${
                          (item.level / 5) * 100
                        }%"></div>
                    </div>
                </div>
            `
          )
          .join("");
      }

      function renderAchievements() {
        const container = document.getElementById("achievementsList");
        const items = qualificationsData.achievements || [];

        if (items.length === 0) {
          container.innerHTML =
            '<div style="text-align: center; padding: var(--space-4); color: var(--color-gray-700);">Ch∆∞a c√≥ th√†nh t√≠ch n√†o. Click "Th√™m" ƒë·ªÉ b·∫Øt ƒë·∫ßu!</div>';
          return;
        }

        container.innerHTML = items
          .map(
            (item, index) => `
                <div class="achievement-item" onclick="viewAchievementDetail(${index})" style="cursor: pointer;">
                    <div class="achievement-title">üèÜ ${item.title}</div>
                    <div style="color: var(--color-gray-700); margin-bottom: var(--space-1);">
                        ${item.issuer ? item.issuer + " ‚Ä¢ " : ""}${item.date}
                    </div>
                    ${
                      item.description
                        ? `<p style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${item.description}</p>`
                        : ""
                    }
                </div>
            `
          )
          .join("");
      }

      async function handleAddEducation(event) {
        event.preventDefault();

        // 1. Get Elements
        const schoolEl = document.getElementById("eduSchool");
        const degreeEl = document.getElementById("eduDegree");
        const startYearEl = document.getElementById("eduStartYear");

        // 2. Clear errors
        document.getElementById("error-eduSchool").textContent = "";
        document.getElementById("error-eduDegree").textContent = "";
        document.getElementById("error-eduStartYear").textContent = "";

        let hasError = false;

        // 3. Validate
        if (!schoolEl.value.trim()) {
          document.getElementById("error-eduSchool").textContent =
            "Vui l√≤ng nh·∫≠p tr∆∞·ªùng/c∆° s·ªü ƒë√†o t·∫°o";
          hasError = true;
        }

        if (!degreeEl.value.trim()) {
          document.getElementById("error-eduDegree").textContent =
            "Vui l√≤ng nh·∫≠p b·∫±ng c·∫•p/ch·ª©ng ch·ªâ";
          hasError = true;
        }

        if (!startYearEl.value.trim()) {
          document.getElementById("error-eduStartYear").textContent =
            "Vui l√≤ng nh·∫≠p nƒÉm b·∫Øt ƒë·∫ßu";
          hasError = true;
        } else if (
          parseInt(startYearEl.value) < 1950 ||
          parseInt(startYearEl.value) > 2030
        ) {
          document.getElementById("error-eduStartYear").textContent =
            "NƒÉm kh√¥ng h·ª£p l·ªá (1950-2030)";
          hasError = true;
        }

        if (hasError) return;

        const form = document.getElementById("educationForm");
        const isEdit = form.dataset.editIndex !== undefined;
        const editIndex = parseInt(form.dataset.editIndex);

        const newItem = {
          school: schoolEl.value,
          degree: degreeEl.value,
          startYear: startYearEl.value,
          endYear: document.getElementById("eduEndYear").value,
          description: document.getElementById("eduDescription").value,
        };

        try {
          // showToast(isEdit ? "ƒêang c·∫≠p nh·∫≠t..." : "ƒêang th√™m...", "info");
          document.body.style.cursor = "wait";

          const endpoint = isEdit
            ? `/qualifications/education/${editIndex}`
            : "/qualifications/education";
          const method = isEdit ? "PUT" : "POST";

          await apiCall(endpoint, {
            method: method,
            body: JSON.stringify(newItem),
          });

          showToast(
            isEdit
              ? "C·∫≠p nh·∫≠t h·ªçc v·∫•n th√†nh c√¥ng!"
              : "Th√™m h·ªçc v·∫•n th√†nh c√¥ng!",
            "success"
          );
          closeModal("addEducationModal");
          document.getElementById("educationForm").reset();
          delete form.dataset.editIndex;

          // Reset modal title
          document.querySelector(
            "#addEducationModal .modal-title"
          ).textContent = "TH√äM H·ªåC V·∫§N";
          document.querySelector(
            '#educationForm button[type="submit"]'
          ).textContent = "Th√™m";

          await loadQualifications();
        } catch (error) {
          showToast(
            error.message || (isEdit ? "C·∫≠p nh·∫≠t th·∫•t b·∫°i" : "Th√™m th·∫•t b·∫°i"),
            "error"
          );
        } finally {
          document.body.style.cursor = "default";
        }
      }

      async function handleAddExperience(event) {
        event.preventDefault();

        // 1. Get Elements
        const companyEl = document.getElementById("expCompany");
        const positionEl = document.getElementById("expPosition");
        const startDateEl = document.getElementById("expStartDate");

        // 2. Clear errors
        document.getElementById("error-expCompany").textContent = "";
        document.getElementById("error-expPosition").textContent = "";
        document.getElementById("error-expStartDate").textContent = "";

        let hasError = false;

        // 3. Validate
        if (!companyEl.value.trim()) {
          document.getElementById("error-expCompany").textContent =
            "Vui l√≤ng nh·∫≠p c√¥ng ty/t·ªï ch·ª©c";
          hasError = true;
        }

        if (!positionEl.value.trim()) {
          document.getElementById("error-expPosition").textContent =
            "Vui l√≤ng nh·∫≠p v·ªã tr√≠";
          hasError = true;
        }

        if (!startDateEl.value.trim()) {
          document.getElementById("error-expStartDate").textContent =
            "Vui l√≤ng nh·∫≠p nƒÉm b·∫Øt ƒë·∫ßu";
          hasError = true;
        } else if (
          parseInt(startDateEl.value) < 1950 ||
          parseInt(startDateEl.value) > 2030
        ) {
          document.getElementById("error-expStartDate").textContent =
            "NƒÉm kh√¥ng h·ª£p l·ªá (1950-2030)";
          hasError = true;
        }

        if (hasError) return;

        const form = document.getElementById("experienceForm");
        const isEdit = form.dataset.editIndex !== undefined;
        const editIndex = parseInt(form.dataset.editIndex);

        const newItem = {
          company: companyEl.value,
          position: positionEl.value,
          startDate: startDateEl.value,
          endDate: document.getElementById("expEndDate").value,
          description: document.getElementById("expDescription").value,
        };

        try {
          // showToast(isEdit ? "ƒêang c·∫≠p nh·∫≠t..." : "ƒêang th√™m...", "info");
          document.body.style.cursor = "wait";

          const endpoint = isEdit
            ? `/qualifications/experience/${editIndex}`
            : "/qualifications/experience";
          const method = isEdit ? "PUT" : "POST";

          await apiCall(endpoint, {
            method: method,
            body: JSON.stringify(newItem),
          });

          showToast(
            isEdit
              ? "C·∫≠p nh·∫≠t kinh nghi·ªám th√†nh c√¥ng!"
              : "Th√™m kinh nghi·ªám th√†nh c√¥ng!",
            "success"
          );
          closeModal("addExperienceModal");
          document.getElementById("experienceForm").reset();
          delete form.dataset.editIndex;

          document.querySelector(
            "#addExperienceModal .modal-title"
          ).textContent = "TH√äM KINH NGHI·ªÜM";
          document.querySelector(
            '#experienceForm button[type="submit"]'
          ).textContent = "Th√™m";

          await loadQualifications();
        } catch (error) {
          showToast(
            error.message || (isEdit ? "C·∫≠p nh·∫≠t th·∫•t b·∫°i" : "Th√™m th·∫•t b·∫°i"),
            "error"
          );
        } finally {
          document.body.style.cursor = "default";
        }
      }

      async function handleAddSkill(event) {
        event.preventDefault();

        // 1. Get Elements
        const skillNameEl = document.getElementById("skillName");

        // 2. Clear errors
        document.getElementById("error-skillName").textContent = "";

        // 3. Validate
        let hasError = false;
        if (!skillNameEl.value.trim()) {
          document.getElementById("error-skillName").textContent =
            "Vui l√≤ng nh·∫≠p t√™n k·ªπ nƒÉng";
          hasError = true;
        }

        if (hasError) return;

        const form = document.getElementById("skillForm");
        const isEdit = form.dataset.editIndex !== undefined;
        const editIndex = parseInt(form.dataset.editIndex);

        const newItem = {
          name: skillNameEl.value,
          level: document.getElementById("skillLevel").value,
        };

        try {
          // showToast(isEdit ? "ƒêang c·∫≠p nh·∫≠t..." : "ƒêang th√™m...", "info");
          document.body.style.cursor = "wait";

          const endpoint = isEdit
            ? `/qualifications/skills/${editIndex}`
            : "/qualifications/skills";
          const method = isEdit ? "PUT" : "POST";

          await apiCall(endpoint, {
            method: method,
            body: JSON.stringify(newItem),
          });

          showToast(
            isEdit
              ? "C·∫≠p nh·∫≠t k·ªπ nƒÉng th√†nh c√¥ng!"
              : "Th√™m k·ªπ nƒÉng th√†nh c√¥ng!",
            "success"
          );
          closeModal("addSkillModal");
          document.getElementById("skillForm").reset();
          delete form.dataset.editIndex;

          // Reset slider value
          document.getElementById("skillLevel").value = 3;
          document.getElementById("skillLevelValue").textContent = "3";

          document.querySelector("#addSkillModal .modal-title").textContent =
            "TH√äM K·ª∏ NƒÇNG";
          document.querySelector(
            '#skillForm button[type="submit"]'
          ).textContent = "Th√™m";

          await loadQualifications();
        } catch (error) {
          showToast(
            error.message || (isEdit ? "C·∫≠p nh·∫≠t th·∫•t b·∫°i" : "Th√™m th·∫•t b·∫°i"),
            "error"
          );
        } finally {
          document.body.style.cursor = "default";
        }
      }

      async function handleAddAchievement(event) {
        event.preventDefault();

        // 1. Get Elements
        const achTitleEl = document.getElementById("achTitle");
        const achDateEl = document.getElementById("achDate");

        // 2. Clear errors
        document.getElementById("error-achTitle").textContent = "";
        document.getElementById("error-achDate").textContent = "";

        let hasError = false;

        // 3. Validate
        if (!achTitleEl.value.trim()) {
          document.getElementById("error-achTitle").textContent =
            "Vui l√≤ng nh·∫≠p danh hi·ªáu/gi·∫£i th∆∞·ªüng";
          hasError = true;
        }

        if (!achDateEl.value.trim()) {
          document.getElementById("error-achDate").textContent =
            "Vui l√≤ng nh·∫≠p nƒÉm ƒë·∫°t ƒë∆∞·ª£c";
          hasError = true;
        } else if (
          parseInt(achDateEl.value) < 1950 ||
          parseInt(achDateEl.value) > 2030
        ) {
          document.getElementById("error-achDate").textContent =
            "NƒÉm kh√¥ng h·ª£p l·ªá (1950-2030)";
          hasError = true;
        }

        if (hasError) return;

        const form = document.getElementById("achievementForm");
        const isEdit = form.dataset.editIndex !== undefined;
        const editIndex = parseInt(form.dataset.editIndex);

        const newItem = {
          title: achTitleEl.value,
          issuer: document.getElementById("achIssuer").value,
          date: achDateEl.value,
          description: document.getElementById("achDescription").value,
        };

        try {
          // showToast(isEdit ? "ƒêang c·∫≠p nh·∫≠t..." : "ƒêang th√™m...", "info");
          document.body.style.cursor = "wait";

          const endpoint = isEdit
            ? `/qualifications/achievements/${editIndex}`
            : "/qualifications/achievements";
          const method = isEdit ? "PUT" : "POST";

          await apiCall(endpoint, {
            method: method,
            body: JSON.stringify(newItem),
          });

          showToast(
            isEdit
              ? "C·∫≠p nh·∫≠t th√†nh t√≠ch th√†nh c√¥ng!"
              : "Th√™m th√†nh t√≠ch th√†nh c√¥ng!",
            "success"
          );
          closeModal("addAchievementModal");
          document.getElementById("achievementForm").reset();
          delete form.dataset.editIndex;

          document.querySelector(
            "#addAchievementModal .modal-title"
          ).textContent = "TH√äM TH√ÄNH T√çCH";
          document.querySelector(
            '#achievementForm button[type="submit"]'
          ).textContent = "Th√™m";

          await loadQualifications();
        } catch (error) {
          showToast(
            error.message || (isEdit ? "C·∫≠p nh·∫≠t th·∫•t b·∫°i" : "Th√™m th·∫•t b·∫°i"),
            "error"
          );
        } finally {
          document.body.style.cursor = "default";
        }
      }
      // View detail functions
      function viewEducationDetail(index) {
        const item = qualificationsData.education[index];
        document.getElementById("detailModalTitle").textContent =
          "CHI TI·∫æT H·ªåC V·∫§N";
        document.getElementById("detailModalBody").innerHTML = `
                <div class="form-group">
                    <label class="form-label">B·∫±ng c·∫•p/Ch·ª©ng ch·ªâ</label>
                    <div style="font-size: 1.125rem; font-weight: 700; margin-bottom: var(--space-2);">${
                      item.degree
                    }</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Tr∆∞·ªùng/C∆° s·ªü ƒë√†o t·∫°o</label>
                    <div>${item.school}</div>
                </div>
                <div class="grid grid-2 gap-3">
                    <div class="form-group">
                        <label class="form-label">NƒÉm b·∫Øt ƒë·∫ßu</label>
                        <div>${item.startYear}</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">NƒÉm k·∫øt th√∫c</label>
                        <div>${item.endYear || "Hi·ªán t·∫°i"}</div>
                    </div>
                </div>
                ${
                  item.description
                    ? `
                    <div class="form-group">
                        <label class="form-label">M√¥ t·∫£</label>
                        <div style="white-space: pre-wrap;">${item.description}</div>
                    </div>
                `
                    : ""
                }
            `;
        showModal("viewDetailModal");
      }

      function viewExperienceDetail(index) {
        const item = qualificationsData.experience[index];
        document.getElementById("detailModalTitle").textContent =
          "CHI TI·∫æT KINH NGHI·ªÜM";
        document.getElementById("detailModalBody").innerHTML = `
                <div class="form-group">
                    <label class="form-label">V·ªã tr√≠</label>
                    <div style="font-size: 1.125rem; font-weight: 700; margin-bottom: var(--space-2);">${
                      item.position
                    }</div>
                </div>
                <div class="form-group">
                    <label class="form-label">C√¥ng ty/T·ªï ch·ª©c</label>
                    <div>${item.company}</div>
                </div>
                <div class="grid grid-2 gap-3">
                    <div class="form-group">
                        <label class="form-label">T·ª´ nƒÉm</label>
                        <div>${item.startDate}</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ƒê·∫øn nƒÉm</label>
                        <div>${item.endDate || "Hi·ªán t·∫°i"}</div>
                    </div>
                </div>
                ${
                  item.description
                    ? `
                    <div class="form-group">
                        <label class="form-label">M√¥ t·∫£ c√¥ng vi·ªác</label>
                        <div style="white-space: pre-wrap;">${item.description}</div>
                    </div>
                `
                    : ""
                }
            `;
        showModal("viewDetailModal");
      }

      function viewAchievementDetail(index) {
        const item = qualificationsData.achievements[index];
        document.getElementById("detailModalTitle").textContent =
          "CHI TI·∫æT TH√ÄNH T√çCH";
        document.getElementById("detailModalBody").innerHTML = `
                <div class="form-group">
                    <label class="form-label">Danh hi·ªáu/Gi·∫£i th∆∞·ªüng</label>
                    <div style="font-size: 1.125rem; font-weight: 700; margin-bottom: var(--space-2);">üèÜ ${
                      item.title
                    }</div>
                </div>
                ${
                  item.issuer
                    ? `
                    <div class="form-group">
                        <label class="form-label">C∆° quan c·∫•p</label>
                        <div>${item.issuer}</div>
                    </div>
                `
                    : ""
                }
                <div class="form-group">
                    <label class="form-label">NƒÉm ƒë·∫°t ƒë∆∞·ª£c</label>
                    <div>${item.date}</div>
                </div>
                ${
                  item.description
                    ? `
                    <div class="form-group">
                        <label class="form-label">M√¥ t·∫£</label>
                        <div style="white-space: pre-wrap;">${item.description}</div>
                    </div>
                `
                    : ""
                }
            `;
        showModal("viewDetailModal");
      }

      function viewSkillDetail(index) {
        currentDetailType = "skill";
        currentDetailIndex = index;
        const item = qualificationsData.skills[index];
        document.getElementById("detailModalTitle").textContent =
          "CHI TI·∫æT K·ª∏ NƒÇNG";
        document.getElementById("detailModalBody").innerHTML = `
          <div class="form-group">
            <label class="form-label">T√™n k·ªπ nƒÉng</label>
            <div style="font-size: 1.125rem; font-weight: 700; margin-bottom: var(--space-2);">${
              item.name
            }</div>
          </div>
          <div class="form-group">
            <label class="form-label">Tr√¨nh ƒë·ªô</label>
            <div style="display: flex; align-items: center; gap: var(--space-2);">
              <div class="skill-bar" style="flex: 1; margin: 0;">
                <div class="skill-bar-fill" style="width: ${
                  (item.level / 5) * 100
                }%"></div>
              </div>
              <span style="font-family: var(--font-mono); font-size: 1.25rem; font-weight: 700;">${
                item.level
              }/5</span>
            </div>
          </div>
        `;
        showModal("viewDetailModal");
      }

      // Track current detail for edit/delete
      let currentDetailType = "";
      let currentDetailIndex = -1;

      // Update view functions to track type and index
      const originalViewEducation = viewEducationDetail;
      viewEducationDetail = function (index) {
        currentDetailType = "education";
        currentDetailIndex = index;
        originalViewEducation(index);
      };

      const originalViewExperience = viewExperienceDetail;
      viewExperienceDetail = function (index) {
        currentDetailType = "experience";
        currentDetailIndex = index;
        originalViewExperience(index);
      };

      const originalViewAchievement = viewAchievementDetail;
      viewAchievementDetail = function (index) {
        currentDetailType = "achievement";
        currentDetailIndex = index;
        originalViewAchievement(index);
      };

      // Edit from detail modal
      function handleEditFromDetail() {
        closeModal("viewDetailModal");

        if (currentDetailType === "education") {
          const item = qualificationsData.education[currentDetailIndex];
          document.getElementById("eduSchool").value = item.school;
          document.getElementById("eduDegree").value = item.degree;
          document.getElementById("eduStartYear").value = item.startYear;
          document.getElementById("eduEndYear").value = item.endYear || "";
          document.getElementById("eduDescription").value =
            item.description || "";

          document.querySelector(
            "#addEducationModal .modal-title"
          ).textContent = "CH·ªàNH S·ª¨A H·ªåC V·∫§N";
          document.querySelector(
            '#educationForm button[type="submit"]'
          ).textContent = "C·∫≠p nh·∫≠t";
          document.getElementById("educationForm").dataset.editIndex =
            currentDetailIndex;

          showModal("addEducationModal");
        } else if (currentDetailType === "experience") {
          const item = qualificationsData.experience[currentDetailIndex];
          document.getElementById("expCompany").value = item.company;
          document.getElementById("expPosition").value = item.position;
          document.getElementById("expStartDate").value = item.startDate;
          document.getElementById("expEndDate").value = item.endDate || "";
          document.getElementById("expDescription").value =
            item.description || "";

          document.querySelector(
            "#addExperienceModal .modal-title"
          ).textContent = "CH·ªàNH S·ª¨A KINH NGHI·ªÜM";
          document.querySelector(
            '#experienceForm button[type="submit"]'
          ).textContent = "C·∫≠p nh·∫≠t";
          document.getElementById("experienceForm").dataset.editIndex =
            currentDetailIndex;

          showModal("addExperienceModal");
        } else if (currentDetailType === "achievement") {
          const item = qualificationsData.achievements[currentDetailIndex];
          document.getElementById("achTitle").value = item.title;
          document.getElementById("achIssuer").value = item.issuer || "";
          document.getElementById("achDate").value = item.date;
          document.getElementById("achDescription").value =
            item.description || "";

          document.querySelector(
            "#addAchievementModal .modal-title"
          ).textContent = "CH·ªàNH S·ª¨A TH√ÄNH T√çCH";
          document.querySelector(
            '#achievementForm button[type="submit"]'
          ).textContent = "C·∫≠p nh·∫≠t";
          document.getElementById("achievementForm").dataset.editIndex =
            currentDetailIndex;

          showModal("addAchievementModal");
        } else if (currentDetailType === "skill") {
          const item = qualificationsData.skills[currentDetailIndex];
          document.getElementById("skillName").value = item.name;
          document.getElementById("skillLevel").value = item.level;
          document.getElementById("skillLevelValue").textContent = item.level;

          document.querySelector("#addSkillModal .modal-title").textContent =
            "CH·ªàNH S·ª¨A K·ª∏ NƒÇNG";
          document.querySelector(
            '#skillForm button[type="submit"]'
          ).textContent = "C·∫≠p nh·∫≠t";
          document.getElementById("skillForm").dataset.editIndex =
            currentDetailIndex;

          showModal("addSkillModal");
        }
      }

      // Delete from detail modal
      async function handleDeleteFromDetail() {
        if (!(await showConfirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a m·ª•c n√†y?"))) return;

        try {
          // showToast("ƒêang x√≥a...", "info");
          document.body.style.cursor = "wait";

          let endpoint = "";
          if (currentDetailType === "education") {
            endpoint = `/qualifications/education/${currentDetailIndex}`;
          } else if (currentDetailType === "experience") {
            endpoint = `/qualifications/experience/${currentDetailIndex}`;
          } else if (currentDetailType === "achievement") {
            endpoint = `/qualifications/achievements/${currentDetailIndex}`;
          } else if (currentDetailType === "skill") {
            endpoint = `/qualifications/skills/${currentDetailIndex}`;
          }

          await apiCall(endpoint, { method: "DELETE" });

          showToast("X√≥a th√†nh c√¥ng!", "success");
          closeModal("viewDetailModal");
          await loadQualifications();
        } catch (error) {
          showToast(error.message || "X√≥a th·∫•t b·∫°i", "error");
        } finally {
          document.body.style.cursor = "default";
        }
      }
    </script>
  </body>
</html>
