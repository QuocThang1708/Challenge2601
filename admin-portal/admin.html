<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>H·ªá Th·ªëng Qu·∫£n Tr·ªã - HRM</title>
    <link rel="stylesheet" href="../shared/styles.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      /* Day selector buttons */
      .day-btn {
        padding: 10px;
        border: 2px solid #e0e0e0;
        border-radius: 6px;
        cursor: pointer;
        text-align: center;
        transition: all 0.2s;
        background: white;
        font-weight: 600;
        user-select: none;
      }
      .day-btn:hover {
        border-color: #b91c1c;
        background: #fef2f2;
      }
      .day-btn.active {
        border-color: #dc2626;
        background: #dc2626;
        color: white;
      }
      /* Week selector */
      .week-selector {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }
      /* Month grid - calendar style */
      .month-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 8px;
        max-width: 420px;
      }
      /* Frequency tab active state */
      .freq-tab.active {
        border-color: #dc2626 !important;
        background: #fef2f2 !important;
      }
      .freq-tab.active span {
        color: #dc2626;
      }
      /* Chart Loader Spinner */
      .chart-loader {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10;
        border-radius: 8px;
        transition: opacity 0.3s ease;
      }
      .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #dc2626;
        border-radius: 50%;
        width: 32px;
        height: 32px;
        animation: spin 1s linear infinite;
      }
      
      /* Standardized Page Header */
      .page-header {
        display: flex !important;
        justify-content: space-between !important;
        align-items: flex-end !important;
        width: 100% !important;
        margin-bottom: 24px !important;
        /* Matches .topbar spacing: 24px left/right */
        padding: 0 24px 16px 24px !important;
        border-bottom: 2px solid #eee !important;
        box-sizing: border-box !important; /* Ensure padding doesn't overflow width */
        gap: 0 !important;
      }
      .page-header h1 {
        font-size: 1.75rem !important;
        font-weight: 700 !important;
        letter-spacing: -0.01em !important;
        color: #111 !important;
        margin: 0 0 4px 0 !important;
        padding: 0 !important;
        line-height: 1.2 !important;
      }
      .page-header p {
        color: #555 !important;
        font-size: 0.95rem !important;
        margin: 0 !important;
        padding: 0 !important;
        line-height: 1.4 !important;
      }
      .page-header .actions {
        display: flex !important;
        gap: 12px !important;
        align-items: center !important;
        flex-shrink: 0 !important;
        margin-left: auto !important;
        /* Removing explicit padding-right as container handles it */
        padding-right: 0 !important;
      }
      .page-header .actions .btn {
        padding: 10px 20px !important;
        font-size: 0.9rem !important;
        font-weight: 600 !important;
        white-space: nowrap !important;
        margin: 0 !important;
      }
      
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
    </style>
  </head>
  <body>
    <!-- APP LAYOUT -->
    <div class="app-layout">
      <!-- SIDEBAR -->
      <aside class="sidebar">
        <div class="sidebar-header">
          <img src="../shared/logo.png" alt="Logo" />
          <div class="logo-text">
            <span style="display: block; font-size: 1.1rem; font-weight: 800"
              >QU·∫¢N TR·ªä</span
            >
            <span
              style="
                display: block;
                font-size: 0.8rem;
                font-weight: 500;
                color: #94a3b8;
              "
              >H·ªÜ TH·ªêNG</span
            >
          </div>
        </div>

        <nav class="sidebar-nav">
          <a
            href="#dashboard"
            class="nav-item active"
            onclick="switchTab('dashboard')"
          >
            <i class="fas fa-home"></i> Dashboard
          </a>

          <div class="nav-group">
            <span class="nav-label">QU·∫¢N L√ù</span>
            <a href="#users" class="nav-item" onclick="switchTab('users')">
              <i class="fas fa-users"></i> Nh√¢n s·ª±
            </a>
            <a
              href="#permissions"
              class="nav-item"
              onclick="switchTab('permissions')"
            >
              <i class="fas fa-user-shield"></i> Ph√¢n quy·ªÅn
            </a>
            <a
              href="#departments"
              class="nav-item"
              onclick="switchTab('departments')"
            >
              <i class="fas fa-building"></i> Ph√≤ng ban
            </a>
          </div>

          <div class="nav-group">
            <span class="nav-label">B√ÅO C√ÅO & D·ªÆ LI·ªÜU</span>
            <a href="#reports" class="nav-item" onclick="switchTab('reports')">
              <i class="fas fa-chart-bar"></i> B√°o c√°o
            </a>
            <a href="#audit" class="nav-item" onclick="switchTab('audit')">
              <i class="fas fa-history"></i> Nh·∫≠t k√Ω
            </a>
          </div>
        </nav>
      </aside>

      <!-- MAIN CONTENT -->
      <main class="main-content">
        <!-- TOPBAR -->
        <header class="topbar">
          <h2 class="page-title" id="pageTitle">Dashboard</h2>

          <div class="user-profile">
            <div class="text-right">
              <span
                id="userGreeting"
                class="block"
                style="font-weight: 700; color: var(--color-primary)"
                >Admin</span
              >
              <span
                class="block text-xs"
                style="color: var(--color-text-secondary)"
                >Qu·∫£n tr·ªã vi√™n</span
              >
            </div>
            <button
              onclick="logout()"
              class="btn btn-icon btn-outline"
              title="ƒêƒÉng xu·∫•t"
            >
              <i class="fas fa-sign-out-alt"></i>
            </button>
          </div>
        </header>

        <!-- CONTENT WRAPPER -->
        <div class="content-wrapper">
          <!-- DASHBOARD SECTION -->
          <div id="dashboard-section">
            <!-- Charts Section -->
            <div class="flex justify-between items-center mb-4">
                <div>
                  <h1 id="welcomeTitle" class="mb-2">QU·∫¢N TR·ªä H·ªÜ TH·ªêNG</h1>
                  <p class="text-gray-700">
                    Xin ch√†o,
                    <span id="adminName" style="font-weight: 700">ADMIN</span>
                  </p>
                </div>
                <div class="user-avatar" style="background: var(--color-red)">
                  <span id="adminInitials">A</span>
                </div>
              </div>

              <!-- Stats Cards -->
              <div class="grid grid-4 mb-4">
                <div class="stat-card">
                  <div class="stat-number" id="totalEmployees">-</div>
                  <div class="stat-label">T·ªîNG C√ÅN B·ªò</div>
                  <div
                    class="stat-change"
                    style="
                      color: var(--color-gray-700);
                      font-size: 0.75rem;
                      margin-top: 8px;
                    "
                  >
                    +12 th√°ng n√†y
                  </div>
                </div>
                <div class="stat-card" style="border-color: var(--color-red)">
                  <div
                    class="stat-number"
                    id="activeEmployees"
                    style="color: var(--color-red)"
                  >
                    -
                  </div>
                  <div class="stat-label">ƒêANG C√îNG T√ÅC</div>
                  <div
                    class="stat-change"
                    style="
                      color: var(--color-gray-700);
                      font-size: 0.75rem;
                      margin-top: 8px;
                    "
                  >
                    91% t·ªïng s·ªë
                  </div>
                </div>
                <div class="stat-card">
                  <div class="stat-number" id="totalDepartments">-</div>
                  <div class="stat-label">ƒê∆†N V·ªä</div>
                  <div
                    class="stat-change"
                    style="
                      color: var(--color-gray-700);
                      font-size: 0.75rem;
                      margin-top: 8px;
                    "
                  >
                    H√†nh ch√≠nh l·ªõn nh·∫•t
                  </div>
                </div>
                <div class="stat-card">
                  <div class="stat-number" id="recentActivities">-</div>
                  <div class="stat-label">HO·∫†T ƒê·ªòNG H√îM NAY</div>
                  <div
                    class="stat-change"
                    style="
                      color: var(--color-gray-700);
                      font-size: 0.75rem;
                      margin-top: 8px;
                    "
                  >
                    15 so v·ªõi h√¥m qua
                  </div>
                </div>
              </div>

              <!-- Charts Section -->
              <div class="grid grid-2 mb-4">
                <!-- Employees by Department -->
                <div class="card">
                  <div class="card-header">
                    <h3 class="card-title">PH√ÇN B·ªê THEO ƒê∆†N V·ªä</h3>
                  </div>
                  <div class="card-body">
                    <div style="height: 300px; position: relative">
                      <div id="dept-chart-loader" class="chart-loader">
                        <div class="spinner"></div>
                      </div>
                      <canvas id="departmentChart"></canvas>
                    </div>
                  </div>
                </div>

                <!-- Gender Distribution -->
                <div class="card">
                  <div class="card-header">
                    <h3 class="card-title">PH√ÇN B·ªê THEO GI·ªöI T√çNH</h3>
                  </div>
                  <div class="card-body">
                    <div
                      style="
                        height: 300px;
                        position: relative;
                        display: flex;
                        justify-content: center;
                      "
                    >
                      <div id="gender-chart-loader" class="chart-loader">
                        <div class="spinner"></div>
                      </div>
                      <canvas id="genderChart"></canvas>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Recent Activity -->
              <div class="card">
                <div class="card-header">
                  <div class="flex justify-between items-center">
                    <h3 class="card-title">HO·∫†T ƒê·ªòNG G·∫¶N ƒê√ÇY</h3>
                    <a href="#audit" class="text-sm text-primary hover:underline" onclick="switchSection('audit')">Xem th√™m</a>
                  </div>
                </div>
                <div class="card-body">
                  <div class="activity-list" id="activityList">
                    <!-- Loaded by JS -->
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- USERS SECTION -->
          <div id="users-section" style="display: none">
            <div class="page-header">
              <div>
                <h1>QU·∫¢N L√ù NG∆Ø·ªúI D√ôNG</h1>
                <p>Danh s√°ch c√°n b·ªô nh√¢n vi√™n trong h·ªá th·ªëng</p>
              </div>
              <div class="actions">
                <button class="btn btn-primary" onclick="openAddUserModal()">
                  + Th√™m c√°n b·ªô
                </button>
              </div>
            </div>

            <!-- Filters -->
            <div class="card mb-4">
              <div class="card-body">
                <div class="grid grid-4 gap-3">
                  <div class="form-group">
                    <label class="form-label" for="searchUser">T√¨m ki·∫øm</label>
                    <input
                      type="text"
                      id="searchUser"
                      class="form-input"
                      placeholder="T√™n, email, m√£ CB..."
                      onkeyup="filterUsers()"
                    />
                  </div>
                  <div class="form-group">
                    <label class="form-label" for="filterDepartment"
                      >Ph√≤ng ban</label
                    >
                    <select
                      id="filterDepartment"
                      class="form-select"
                      onchange="filterUsers()"
                    >
                      <option value="">T·∫•t c·∫£</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label class="form-label" for="filterRole">Vai tr√≤</label>
                    <select
                      id="filterRole"
                      class="form-select"
                      onchange="filterUsers()"
                    >
                      <option value="">T·∫•t c·∫£</option>
                      <option value="admin">Admin t·ªïng</option>
                      <option value="dept_admin">Admin ƒë∆°n v·ªã</option>
                      <option value="user">C√°n b·ªô th∆∞·ªùng</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label class="form-label" for="filterStatus"
                      >Tr·∫°ng th√°i</label
                    >
                    <select
                      id="filterStatus"
                      class="form-select"
                      onchange="filterUsers()"
                    >
                      <option value="">T·∫•t c·∫£</option>
                      <option value="ƒêang c√¥ng t√°c">ƒêang c√¥ng t√°c</option>
                      <option value="ƒê√£ ngh·ªâ vi·ªác">Ngh·ªâ vi·ªác</option>
                      <option value="Chuy·ªÉn ƒë∆°n v·ªã">Chuy·ªÉn ƒë∆°n v·ªã</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>

            <!-- Users Table -->
            <div class="card">
              <div class="card-header">
                <div class="flex justify-between items-center">
                  <h3 class="card-title">DANH S√ÅCH C√ÅN B·ªò</h3>
                  <div class="flex gap-2">
                    <button
                      class="btn btn-small btn-outline"
                      onclick="
                        exportTableToCSV('usersTable', 'danh-sach-can-bo.csv')
                      "
                    >
                      Xu·∫•t CSV
                    </button>
                  </div>
                </div>
              </div>
              <div class="card-body">
                <div class="table-container">
                  <table class="table" id="usersTable">
                    <thead>
                      <tr>
                        <th>H·ªç v√† t√™n</th>
                        <th>M√£ c√°n b·ªô</th>
                        <th>Email</th>
                        <th>Vai tr√≤</th>
                        <th>Ph√≤ng ban</th>
                        <th>Ch·ª©c v·ª•</th>
                        <th class="text-center" style="width: 120px">
                          Tr·∫°ng th√°i
                        </th>
                        <th class="text-center" style="width: 100px">
                          Thao t√°c
                        </th>
                      </tr>
                    </thead>
                    <tbody id="usersTableBody">
                      <!-- Users will be loaded here -->
                    </tbody>
                  </table>
                </div>
                <!-- Pagination -->
                <div id="usersPagination" class="pagination"></div>
              </div>
            </div>
          </div>

          <!-- DEPARTMENTS SECTION -->
          <div id="departments-section" style="display: none">
            <!-- Header -->
            <div class="page-header">
              <div>
                <h1>QU·∫¢N L√ù PH√íNG BAN</h1>
                <p>Danh s√°ch c√°c ph√≤ng ban trong h·ªá th·ªëng</p>
              </div>
              <div class="actions">
                <button
                  onclick="openCreateDepartmentModal()"
                  class="btn btn-primary"
                >
                  + TH√äM PH√íNG BAN
                </button>
              </div>
            </div>

            <!-- Filters -->
            <div class="card mb-4">
              <div class="card-body">
                <div class="form-group mb-0">
                  <label class="form-label" for="searchDepartment"
                    >T√¨m ki·∫øm</label
                  >
                  <input
                    type="text"
                    id="searchDepartment"
                    class="form-input"
                    placeholder="Nh·∫≠p t√™n ph√≤ng ban..."
                    onkeyup="filterDepartments()"
                  />
                </div>
              </div>
            </div>

            <!-- Department Table -->
            <div class="card p-0" style="overflow: hidden">
              <div
                class="card-header"
                style="
                  background: white;
                  border-bottom: 2px solid #eee;
                  padding: 16px;
                "
              >
                <div class="flex justify-between items-center">
                  <h3 class="card-title" style="font-size: 1.25rem; margin: 0">
                    DANH S√ÅCH PH√íNG BAN
                  </h3>
                  <button
                    class="btn btn-small btn-outline"
                    onclick="
                      exportTableToCSV(
                        'departmentTable',
                        'danh-sach-phong-ban.csv'
                      )
                    "
                  >
                    XU·∫§T CSV
                  </button>
                </div>
              </div>
              <div class="table-container" style="border: none">
                <table class="table" id="departmentTable">
                  <thead>
                    <tr>
                      <th style="width: 30%">T√äN PH√íNG BAN</th>
                      <th>M√î T·∫¢</th>
                      <th style="width: 20%">NG√ÄY T·∫†O</th>
                      <th style="width: 100px" class="text-center">THAO T√ÅC</th>
                    </tr>
                  </thead>
                  <tbody id="departmentTableBody">
                    <!-- JS renders rows here -->
                    <tr>
                      <td colspan="4" class="text-center p-4">
                        ƒêang t·∫£i d·ªØ li·ªáu...
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <!-- Pagination -->
              <div
                id="departmentsPagination"
                class="pagination"
                style="padding: 16px"
              ></div>
            </div>
          </div>

          <!-- REPORTS SECTION -->
          <div id="reports-section" style="display: none">
            <div class="page-header">
              <div>
                <h1>B√ÅO C√ÅO & TH·ªêNG K√ä</h1>
                <p>Xem v√† xu·∫•t c√°c b√°o c√°o th·ªëng k√™</p>
              </div>
            </div>

            <!-- Report Builder -->
            <div class="card mb-4">
              <div class="card-header">
                <h3 class="card-title">T·∫†O B√ÅO C√ÅO M·ªöI</h3>
              </div>
              <div class="card-body">
                <form id="reportForm" onsubmit="handleGenerateReport(event)">
                  <div class="grid grid-3 gap-3 mb-3">
                    <div class="form-group">
                      <label class="form-label" for="reportType"
                        >Lo·∫°i b√°o c√°o *</label
                      >
                      <select id="reportType" class="form-select" required>
                        <option value="">Ch·ªçn lo·∫°i b√°o c√°o</option>
                        <option value="general">
                          Danh s√°ch tr√≠ch ngang (T·ªïng h·ª£p)
                        </option>
                        <option value="movement">
                          B√°o c√°o Bi·∫øn ƒë·ªông Nh√¢n s·ª±
                        </option>
                        <option value="classifications">
                          B√°o c√°o Ph√¢n lo·∫°i & Quy ho·∫°ch
                        </option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label class="form-label" for="dateFrom">T·ª´ ng√†y</label>
                      <input type="date" id="dateFrom" class="form-input" />
                    </div>
                    <div class="form-group">
                      <label class="form-label" for="dateTo">ƒê·∫øn ng√†y</label>
                      <input type="date" id="dateTo" class="form-input" />
                    </div>
                  </div>

                  <div class="grid grid-2 gap-3 mb-3">
                    <div class="form-group">
                      <label class="form-label" for="department"
                        >PH√íNG BAN (T√ôY CH·ªåN)</label
                      >
                      <select id="reportDepartment" class="form-select">
                        <option value="">T·∫•t c·∫£ ph√≤ng ban</option>
                        <!-- Dynamically loaded -->
                      </select>
                    </div>
                  </div>

                  <div class="flex gap-2">
                    <button
                      type="button"
                      class="btn btn-primary"
                      onclick="handleGenerateReport(event)"
                    >
                      T·∫°o b√°o c√°o
                    </button>
                    <button
                      type="button"
                      class="btn btn-accent"
                      onclick="scheduleReport()"
                    >
                      L√™n l·ªãch
                    </button>
                  </div>
                </form>
              </div>
            </div>

            <!-- Quick Reports -->
            <div class="card mb-4">
              <div class="card-header">
                <h3 class="card-title">B√ÅO C√ÅO NHANH</h3>
              </div>
              <div class="card-body">
                <div class="quick-reports">
                  <button
                    class="report-quick-btn"
                    onclick="generateQuickReport('monthly')"
                  >
                    <div class="report-icon">üìÖ</div>
                    <div>B√°o c√°o th√°ng</div>
                  </button>
                  <button
                    class="report-quick-btn"
                    onclick="generateQuickReport('quarterly')"
                  >
                    <div class="report-icon">üìä</div>
                    <div>B√°o c√°o qu√Ω</div>
                  </button>
                  <button
                    class="report-quick-btn"
                    onclick="generateQuickReport('annual')"
                  >
                    <div class="report-icon">üìà</div>
                    <div>B√°o c√°o nƒÉm</div>
                  </button>
                  <button
                    class="report-quick-btn"
                    onclick="generateQuickReport('custom')"
                  >
                    <div class="report-icon">‚öôÔ∏è</div>
                    <div>T√πy ch·ªânh</div>
                  </button>
                </div>
              </div>
            </div>

            <!-- Scheduled Tasks List -->
            <div class="card mb-4" id="scheduledTasksCard">
              <div class="card-header">
                <h3 class="card-title">C·∫§U H√åNH T·ª∞ ƒê·ªòNG G·ª¨I B√ÅO C√ÅO</h3>
              </div>
              <div class="card-body">
                <table class="table" id="scheduledTasksTable">
                  <thead>
                    <tr>
                      <th>T√™n c·∫•u h√¨nh</th>
                      <th>Lo·∫°i b√°o c√°o</th>
                      <th>L·ªãch ch·∫°y (Cron)</th>
                      <th>Email nh·∫≠n</th>
                      <th class="text-center" style="width: 120px">
                        Tr·∫°ng th√°i
                      </th>
                      <th class="text-center" style="width: 100px">Thao t√°c</th>
                    </tr>
                  </thead>
                  <tbody id="scheduledTasksBody">
                    <tr>
                      <td colspan="5" class="text-center">ƒêang t·∫£i...</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Report History -->
            <div class="card">
              <div class="card-header">
                <div class="flex justify-between items-center">
                  <h3 class="card-title">L·ªäCH S·ª¨ B√ÅO C√ÅO</h3>
                  <input
                    type="text"
                    class="form-input"
                    placeholder="T√¨m ki·∫øm b√°o c√°o..."
                    style="max-width: 300px"
                    onkeyup="filterReports(this.value)"
                  />
                </div>
              </div>
              <div class="card-body">
                <div class="table-container">
                  <table class="table" id="reportsTable">
                    <thead>
                      <tr>
                        <th>M√£ b√°o c√°o</th>
                        <th>T√™n b√°o c√°o</th>
                        <th>Lo·∫°i</th>
                        <th>Ng∆∞·ªùi t·∫°o</th>
                        <th>Ng√†y t·∫°o</th>
                        <th class="text-center" style="width: 120px">
                          Tr·∫°ng th√°i
                        </th>
                        <th class="text-center" style="width: 100px">
                          Thao t√°c
                        </th>
                      </tr>
                    </thead>
                    <tbody id="reportsTableBody">
                      <!-- Reports will be loaded here -->
                    </tbody>
                  </table>
                </div>
                <!-- Pagination -->
                <div id="reportsPagination" class="pagination"></div>
              </div>
            </div>
          </div>

          <!-- PERMISSIONS SECTION -->
          <div id="permissions-section" style="display: none">
            <div class="page-header">
              <div>
                <h1>PH√ÇN QUY·ªÄN H·ªÜ TH·ªêNG</h1>
                <p>Qu·∫£n l√Ω vai tr√≤ v√† quy·ªÅn h·∫°n ng∆∞·ªùi d√πng</p>
              </div>
              <div class="actions">
                <button class="btn btn-primary" onclick="openRoleModal()">
                  + TH√äM ROLE
                </button>
              </div>
            </div>

            <div class="card">
              <div class="table-container">
                <table class="table">
                  <thead>
                    <tr>
                      <th>M√£ Role</th>
                      <th>T√™n Vai tr√≤</th>
                      <th>M√¥ t·∫£</th>
                      <th class="text-center" style="width: 100px">Thao t√°c</th>
                    </tr>
                  </thead>
                  <tbody id="rolesTableBody">
                    <!-- Roles dynamically loaded -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- AUDIT LOG SECTION -->
          <div id="audit-section" style="display: none">
            <div class="page-header">
              <div>
                <h1>NH·∫¨T K√ù HO·∫†T ƒê·ªòNG</h1>
                <p>Theo d√µi c√°c ho·∫°t ƒë·ªông trong h·ªá th·ªëng</p>
              </div>
              <div class="actions">
                <button class="btn btn-outline" onclick="loadAuditLogs()">
                  <i class="fas fa-sync"></i> L√†m m·ªõi
                </button>
              </div>
            </div>

            <div class="card">
              <div class="card-header bg-black text-white">
                <h3 class="card-title text-white">L·ªãch s·ª≠ h·ªá th·ªëng</h3>
              </div>
              <div class="card-body p-0">
                <table class="table table-striped table-hover mb-0">
                  <thead>
                    <tr>
                      <th>Th·ªùi gian</th>
                      <th>Ng∆∞·ªùi th·ª±c hi·ªán</th>
                      <th>H√†nh ƒë·ªông</th>
                      <th>ƒê·ªëi t∆∞·ª£ng</th>
                      <th class="text-center" style="width: 120px">
                        Tr·∫°ng th√°i
                      </th>
                      <th class="text-center" style="width: 100px">Thao t√°c</th>
                    </tr>
                  </thead>
                  <tbody id="auditTableBody">
                    <!-- JS Rendered -->
                  </tbody>
                </table>
                <!-- Pagination -->
                <div
                  id="auditPagination"
                  class="pagination"
                  style="padding: 16px"
                ></div>
              </div>
            </div>
          </div>
          <!-- END AUDIT LOG SECTION -->
        </div>
      </main>
    </div>

    <!-- MODALS -->

    <!-- Role Modal -->
    <div class="modal-overlay" id="roleModal">
      <div class="modal">
        <div class="modal-header">
          <h2 class="modal-title" id="roleModalTitle">TH√äM/S·ª¨A ROLE</h2>
          <button class="modal-close" onclick="closeModal('roleModal')">
            √ó
          </button>
        </div>
        <div class="modal-body">
          <form id="roleForm" onsubmit="handleSaveRole(event)">
            <!-- ID hidden or generated -->
            <input type="hidden" id="roleId" />

            <div class="form-group">
              <label class="form-label" for="roleName">T√™n Vai tr√≤ *</label>
              <input
                type="text"
                id="roleName"
                class="form-input"
                required
                placeholder="VD: Tr∆∞·ªüng ph√≤ng IT"
              />
            </div>

            <div class="form-group">
              <label class="form-label" for="roleType">Lo·∫°i Qu·∫£n tr·ªã *</label>
              <select
                id="roleType"
                class="form-select"
                required
                onchange="handleRoleTypeChange()"
              >
                <option value="user">C√°n b·ªô</option>
                <option value="admin">Admin T·ªïng</option>
                <option value="dept_admin">Admin Ph√≤ng ban</option>
              </select>
            </div>

            <!-- Conditional Department Select -->
            <div
              class="form-group"
              id="roleDepartmentGroup"
              style="display: none"
            >
              <label class="form-label" for="roleDepartment"
                >Thu·ªôc Ph√≤ng ban *</label
              >
              <select id="roleDepartment" class="form-select">
                <option value="">Ch·ªçn ph√≤ng ban √°p d·ª•ng</option>
              </select>
              <small class="text-gray-500"
                >Vai tr√≤ n√†y s·∫Ω ch·ªâ c√≥ quy·ªÅn h·∫°n trong ph·∫°m vi ph√≤ng ban ƒë∆∞·ª£c
                ch·ªçn.</small
              >
            </div>

            <div class="form-group">
              <label class="form-label" for="roleDesc">M√¥ t·∫£</label>
              <textarea id="roleDesc" class="form-input" rows="3"></textarea>
            </div>
            <div class="form-group">
              <button type="submit" class="btn btn-primary" style="width: 100%">
                L∆∞u
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Add User Modal -->
    <div class="modal-overlay" id="addUserModal">
      <div class="modal">
        <div class="modal-header">
          <h2 class="modal-title">TH√äM C√ÅN B·ªò M·ªöI</h2>
          <button class="modal-close" onclick="closeModal('addUserModal')">
            √ó
          </button>
        </div>
        <div class="modal-body">
          <form id="addUserForm" onsubmit="handleAddUser(event)">
            <div class="grid grid-2 gap-3">
              <div class="form-group">
                <label class="form-label" for="newName">H·ªç v√† t√™n *</label>
                <input type="text" id="newName" class="form-input" required />
              </div>
              <div class="form-group">
                <label class="form-label" for="newEmployeeId"
                  >M√£ c√°n b·ªô *</label
                >
                <input
                  type="text"
                  id="newEmployeeId"
                  class="form-input"
                  required
                />
              </div>
              <div class="form-group">
                <label class="form-label" for="newEmail">Email *</label>
                <input type="email" id="newEmail" class="form-input" required />
              </div>
              <div class="form-group">
                <label class="form-label" for="newPhone">S·ªë ƒëi·ªán tho·∫°i *</label>
                <input type="tel" id="newPhone" class="form-input" required />
              </div>
              <div class="form-group">
                <label class="form-label" for="newPassword">M·∫≠t kh·∫©u</label>
                <div class="password-wrapper">
                  <input
                    type="password"
                    id="newPassword"
                    class="form-input"
                    placeholder="M·∫∑c ƒë·ªãnh: password123"
                  />
                  <button
                    type="button"
                    class="password-toggle"
                    onclick="togglePasswordVisibility('newPassword')"
                  >
                    <svg
                      width="20"
                      height="20"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                      <circle cx="12" cy="12" r="3" />
                    </svg>
                  </button>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label" for="newDepartment"
                  >Ph√≤ng ban *</label
                >
                <select id="newDepartment" class="form-select" required>
                  <option value="">Ch·ªçn ph√≤ng ban</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label" for="newRole">Vai tr√≤ *</label>
                <select id="newRole" class="form-select" required>
                  <option value="user">C√°n b·ªô (M·∫∑c ƒë·ªãnh)</option>
                  <option value="dept_admin">Admin ƒê∆°n v·ªã</option>
                  <option value="admin">Admin T·ªïng</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label" for="newPosition">Ch·ª©c v·ª• *</label>
                <input
                  type="text"
                  id="newPosition"
                  class="form-input"
                  required
                />
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-outline"
                onclick="closeModal('addUserModal')"
              >
                H·ªßy
              </button>
              <button type="submit" class="btn btn-primary">Th√™m c√°n b·ªô</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Edit User Modal -->
    <div class="modal-overlay" id="userModal">
      <div class="modal">
        <div class="modal-header">
          <h2 class="modal-title" id="modalTitleUserId">
            CH·ªàNH S·ª¨A NG∆Ø·ªúI D√ôNG
          </h2>
          <button class="modal-close" onclick="closeModal('userModal')">
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="18" y1="6" x2="6" y2="18" />
              <line x1="6" y1="6" x2="18" y2="18" />
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <form id="editUserForm" onsubmit="handleUpdateUser(event)">
            <input type="hidden" id="userId" />
            <div class="grid grid-2 gap-3">
              <div class="form-group">
                <label class="form-label" for="userName">H·ªç v√† t√™n *</label>
                <input type="text" id="userName" class="form-input" required />
              </div>
              <div class="form-group">
                <label class="form-label" for="userEmployeeId"
                  >M√£ c√°n b·ªô *</label
                >
                <input
                  type="text"
                  id="userEmployeeId"
                  class="form-input"
                  required
                />
              </div>
              <div class="form-group">
                <label class="form-label" for="userEmail">Email *</label>
                <input
                  type="email"
                  id="userEmail"
                  class="form-input"
                  required
                />
              </div>
              <div class="form-group">
                <label class="form-label" for="userPhone"
                  >S·ªë ƒëi·ªán tho·∫°i *</label
                >
                <input type="tel" id="userPhone" class="form-input" required />
              </div>
              <div class="form-group">
                <label class="form-label" for="userDept">Ph√≤ng ban</label>
                <select id="userDept" class="form-select">
                  <option value="">Ch·ªçn ph√≤ng ban</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label" for="userRole">Vai tr√≤ *</label>
                <select id="userRole" class="form-select" required>
                  <option value="user">C√°n b·ªô</option>
                  <option value="dept_admin">Admin ƒê∆°n v·ªã</option>
                  <option value="admin">Admin T·ªïng</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label" for="userPosition">Ch·ª©c v·ª•</label>
                <input type="text" id="userPosition" class="form-input" />
              </div>
              <div class="form-group">
                <label class="form-label" for="userStatus">Tr·∫°ng th√°i *</label>
                <select id="userStatus" class="form-select" required>
                  <option value="ƒêang c√¥ng t√°c">ƒêang c√¥ng t√°c</option>
                  <option value="Ngh·ªâ vi·ªác">Ngh·ªâ vi·ªác</option>
                  <option value="Ngh·ªâ ph√©p">Ngh·ªâ ph√©p</option>
                  <option value="Chuy·ªÉn ƒë∆°n v·ªã">Chuy·ªÉn ƒë∆°n v·ªã</option>
                </select>
              </div>
              <div class="form-group" style="grid-column: span 2">
                <label class="form-label" for="userTags"
                  >Nh√£n / Ph√¢n lo·∫°i</label
                >
                <input
                  type="text"
                  id="userTags"
                  class="form-input"
                  placeholder="VD: C√°n b·ªô ngu·ªìn, ƒê·∫£ng vi√™n (ph√¢n c√°ch ph·∫©y)"
                />
              </div>
              <div class="form-group">
                <label class="form-label" for="userDob">Ng√†y sinh</label>
                <input type="date" id="userDob" class="form-input" />
              </div>
              <div class="form-group">
                <label class="form-label" for="userIdCard">CCCD/CMND</label>
                <input type="text" id="userIdCard" class="form-input" />
              </div>
              <div class="form-group">
                <label class="form-label" for="userAddress">ƒê·ªãa ch·ªâ</label>
                <input type="text" id="userAddress" class="form-input" />
              </div>
              <div class="form-group">
                <label class="form-label" for="userJoinDate"
                  >Ng√†y gia nh·∫≠p</label
                >
                <input type="date" id="userJoinDate" class="form-input" />
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-outline"
                onclick="closeModal('userModal')"
              >
                H·ªßy
              </button>
              <button type="submit" class="btn btn-primary">
                L∆∞u thay ƒë·ªïi
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Delete User Confirmation Modal -->
    <div class="modal-overlay" id="deleteConfirmationModal">
      <div class="modal" style="max-width: 400px">
        <div class="modal-header">
          <h2 class="modal-title">X√ÅC NH·∫¨N</h2>
          <button
            class="modal-close"
            onclick="closeModal('deleteConfirmationModal')"
          >
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="18" y1="6" x2="6" y2="18" />
              <line x1="6" y1="6" x2="18" y2="18" />
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <p>
            B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a c√°n b·ªô n√†y? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n
            t√°c.
          </p>
          <input type="hidden" id="deleteUserId" />
        </div>
        <div class="modal-footer">
          <button
            class="btn btn-outline"
            onclick="closeModal('deleteConfirmationModal')"
          >
            H·ªßy
          </button>
          <button class="btn btn-danger" onclick="handleDeleteUser()">
            X√≥a vƒ©nh vi·ªÖn
          </button>
        </div>
      </div>
    </div>
    <!-- Generic Confirmation Modal -->
    <div class="modal-overlay" id="confirmationModal">
      <div class="modal" style="max-width: 400px">
        <div class="modal-header">
          <h2 class="modal-title">X√ÅC NH·∫¨N</h2>
          <button class="modal-close" onclick="closeModal('confirmationModal')">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18" />
              <line x1="6" y1="6" x2="18" y2="18" />
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <p id="confirmationMessage">B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën th·ª±c hi·ªán h√†nh ƒë·ªông n√†y?</p>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline" onclick="closeModal('confirmationModal')">H·ªßy</button>
          <button class="btn btn-primary" id="confirmOkBtn">ƒê·ªíNG √ù</button>
        </div>
      </div>
    </div>
    <!-- View User Modal -->
    <div class="modal-overlay" id="viewUserModal">
      <div class="modal" style="max-width: 800px">
        <div class="modal-header">
          <h2 class="modal-title">CHI TI·∫æT C√ÅN B·ªò</h2>
          <button class="modal-close" onclick="closeModal('viewUserModal')">
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="18" y1="6" x2="6" y2="18" />
              <line x1="6" y1="6" x2="18" y2="18" />
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <div class="tabs-nav">
            <button class="tab-btn active" onclick="switchUserTab('profile')">
              Th√¥ng tin
            </button>
            <button class="tab-btn" onclick="switchUserTab('cvs')">
              H·ªì s∆° ƒëi k√®m
            </button>
            <button class="tab-btn" onclick="switchUserTab('history')">
              L·ªãch s·ª≠ c√¥ng t√°c
            </button>
          </div>

          <!-- Tab Content: Profile -->
          <div
            id="tab-profile"
            class="tab-content active"
            style="display: block"
          >
            <div class="grid grid-2 gap-4">
              <!-- Left Column: Avatar & Basic Info -->
              <div
                class="flex flex-col items-center justify-center text-center"
                style="
                  padding: var(--space-3);
                  background: var(--color-gray-100);
                  border: 2px solid var(--color-black);
                "
              >
                <div
                  class="user-avatar-large mb-3"
                  id="viewUserAvatarContainer"
                >
                  <span id="viewUserAvatarInitials"></span>
                  <img
                    id="viewUserAvatarImg"
                    src=""
                    alt="Avatar"
                    style="
                      display: none;
                      width: 100%;
                      height: 100%;
                      object-fit: cover;
                      border-radius: 50%;
                    "
                  />
                </div>
                <h3 class="user-name mb-2" id="viewUserName"></h3>
                <div id="viewUserRole" class="badge">USER</div>
              </div>

              <!-- Right Column: Detailed Info -->
              <div class="user-details-list">
                <div class="detail-item">
                  <span class="detail-label">M√£ c√°n b·ªô</span>
                  <span class="detail-value" id="viewUserCode">CB000</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Email</span>
                  <span class="detail-value" id="viewUserEmail"></span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">S·ªë ƒëi·ªán tho·∫°i</span>
                  <span class="detail-value" id="viewUserPhone"></span>
                </div>
                <!-- Extended Info -->
                <div class="detail-item">
                  <span class="detail-label">Ng√†y sinh</span>
                  <span class="detail-value" id="viewUserDob">-</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">CCCD/CMND</span>
                  <span class="detail-value" id="viewUserIdCard">-</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">ƒê·ªãa ch·ªâ</span>
                  <span class="detail-value" id="viewUserAddress">-</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">ƒê∆°n v·ªã</span>
                  <span class="detail-value" id="viewUserDept"></span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Ch·ª©c v·ª•</span>
                  <span class="detail-value" id="viewUserPosition"></span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Tr·∫°ng th√°i</span>
                  <span class="detail-value" id="viewUserStatus"></span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Ng√†y gia nh·∫≠p</span>
                  <span class="detail-value" id="viewUserJoinDate">-</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Ng√†y t·∫°o</span>
                  <span class="detail-value" id="viewUserDate"></span>
                </div>
              </div>
            </div>
          </div>

          <!-- Tab Content: CVs -->
          <div id="tab-cvs" class="tab-content" style="display: none">
            <h4 style="margin-bottom: 12px; font-weight: bold">
              Danh s√°ch CV ƒë√£ t·∫£i l√™n
            </h4>
            <div id="viewUserCVList" class="cv-list-container">
              <p class="text-gray-500">ƒêang t·∫£i...</p>
            </div>
          </div>

          <!-- Tab: History -->
          <div id="tab-history" class="tab-content" style="display: none">
            <div style="max-height: 400px; overflow-y: auto; padding: 10px">
              <ul
                id="viewUserHistoryList"
                style="list-style: none; padding: 0; position: relative"
              >
                <!-- JS will render timeline -->
                <li class="text-gray-500 text-center">ƒêang t·∫£i l·ªãch s·ª≠...</li>
              </ul>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button
            class="btn btn-primary"
            id="btnEditUser"
            onclick="
              editUser(window.currentUserIndex);
              closeModal('viewUserModal');
            "
          >
            Ch·ªânh s·ª≠a
          </button>
          <button class="btn btn-outline" onclick="closeModal('viewUserModal')">
            ƒê√≥ng
          </button>
        </div>
      </div>
    </div>

    <!-- Create/Edit Department Modal -->
    <div class="modal-overlay" id="departmentModal">
      <div class="modal">
        <div class="modal-header">
          <h3 class="modal-title" id="modalTitle">TH√äM PH√íNG BAN</h3>
          <button class="modal-close" onclick="closeDepartmentModal()">
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="18" y1="6" x2="6" y2="18" />
              <line x1="6" y1="6" x2="18" y2="18" />
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <form id="departmentForm" onsubmit="handleSaveDepartment(event)">
            <input type="hidden" id="depId" />
            <div class="form-group" style="margin-bottom: 24px">
              <label class="form-label">T√äN PH√íNG BAN *</label>
              <input
                type="text"
                id="depName"
                class="form-input"
                required
                placeholder="V√≠ d·ª•: Ph√≤ng K·ªπ Thu·∫≠t"
              />
            </div>
            <div class="form-group" style="margin-bottom: 24px">
              <label class="form-label">M√î T·∫¢</label>
              <textarea
                id="depDescription"
                class="form-textarea"
                placeholder="Nh·∫≠p m√¥ t·∫£ ch·ª©c nƒÉng, nhi·ªám v·ª•..."
              ></textarea>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-outline"
                onclick="closeDepartmentModal()"
              >
                H·ªßy
              </button>
              <button type="submit" class="btn btn-primary">
                L∆∞u th√¥ng tin
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Confirm Delete Department Modal -->
    <div class="modal-overlay" id="confirmDeleteDepartmentModal">
      <div class="modal" style="max-width: 400px">
        <div class="modal-header bg-black text-white">
          <h3 class="modal-title h5" style="font-size: 1.25rem">X√ÅC NH·∫¨N</h3>
          <button
            class="modal-close text-white"
            onclick="closeDeleteDepartmentModal()"
          >
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="18" y1="6" x2="6" y2="18" />
              <line x1="6" y1="6" x2="18" y2="18" />
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <p>
            B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ph√≤ng ban
            <strong id="deleteDepName"></strong>?
          </p>
          <p class="text-sm text-gray-500 mt-2">
            D·ªØ li·ªáu li√™n quan c√≥ th·ªÉ b·ªã ·∫£nh h∆∞·ªüng. H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n
            t√°c.
          </p>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-outline"
            onclick="closeDeleteDepartmentModal()"
          >
            Kh√¥ng, gi·ªØ l·∫°i
          </button>
          <button
            type="button"
            class="btn btn-accent"
            onclick="confirmDeleteDepartment()"
          >
            C√≥, x√≥a ngay
          </button>
        </div>
      </div>
    </div>

    <!-- View CV Modal -->
    <div class="modal-overlay" id="viewCVModal">
      <div
        class="modal"
        style="
          max-width: 900px;
          width: 90%;
          height: 90vh;
          display: flex;
          flex-direction: column;
        "
      >
        <div
          class="modal-header"
          style="
            background-color: #323639;
            color: white;
            padding: 10px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
          "
        >
          <div style="display: flex; align-items: center; gap: 16px">
            <button
              class="modal-close"
              onclick="closeModal('viewCVModal')"
              style="
                position: static;
                color: white;
                background: none;
                border: none;
                cursor: pointer;
                width: 36px;
                height: 36px;
                display: flex;
                align-items: center;
                justify-content: center;
              "
            >
              <svg
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <line x1="18" y1="6" x2="6" y2="18" />
                <line x1="6" y1="6" x2="18" y2="18" />
              </svg>
            </button>
            <h2
              class="modal-title"
              style="color: white; font-size: 16px; font-weight: 500"
            >
              <span id="viewCVTitle"></span>
            </h2>
          </div>
          <button
            id="headerDownloadBtn"
            class="btn btn-primary"
            style="
              background-color: #8ab4f8;
              color: #333;
              font-weight: 500;
              border: none;
            "
          >
            <i class="fas fa-download" style="margin-right: 5px"></i> T·∫£i xu·ªëng
          </button>
        </div>
        <div
          class="modal-body"
          style="
            flex: 1;
            padding: 0;
            overflow: hidden;
            background: #f5f5f5;
            position: relative;
          "
        >
          <div id="cvPreviewContainer" style="width: 100%; height: 100%"></div>
          <div
            id="cvPreviewMessage"
            style="
              position: absolute;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              display: flex;
              align-items: center;
              justify-content: center;
              flex-direction: column;
              gap: 1rem;
              background: #f5f5f5;
              z-index: 10;
            "
          >
            <p class="text-gray-700">ƒêang t·∫£i...</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Audit Detail Modal -->
    <div class="modal-overlay" id="auditDetailModal">
      <div class="modal" style="max-width: 700px">
        <div
          class="modal-header"
          style="color: #000; border-bottom: 1px solid #eee"
        >
          <h2 class="modal-title" style="font-size: 1.25rem">
            Chi ti·∫øt nh·∫≠t k√Ω
          </h2>
          <button
            class="modal-close"
            style="color: #666"
            onclick="closeModal('auditDetailModal')"
          >
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="18" y1="6" x2="6" y2="18" />
              <line x1="6" y1="6" x2="18" y2="18" />
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <p
            class="mb-3"
            id="auditDetailSummary"
            style="font-weight: 500; color: #333"
          ></p>
          <div class="json-viewer" id="auditJsonContent"></div>
        </div>
        <div class="modal-footer" style="padding: 1rem; background: #fff">
          <button
            class="btn btn-outline"
            onclick="closeModal('auditDetailModal')"
          >
            ƒê√≥ng
          </button>
          <button
            class="btn btn-primary"
            onclick="copyAuditJson()"
            style="background: #fbc02d; border-color: #fbc02d; color: #000"
          >
            Sao ch√©p
          </button>
        </div>
      </div>
    </div>

    <!-- Schedule Report Modal -->
    <div class="modal-overlay" id="scheduleReportModal">
      <div class="modal" style="width: 600px; max-width: 90%">
        <div class="modal-header">
          <h3 class="modal-title">L√äN L·ªäCH B√ÅO C√ÅO</h3>
          <button
            class="modal-close"
            onclick="closeModal('scheduleReportModal')"
          >
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="18" y1="6" x2="6" y2="18" />
              <line x1="6" y1="6" x2="18" y2="18" />
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <form id="scheduleForm" onsubmit="handleSaveSchedule(event)">
            <input type="hidden" id="scheduleId" value="" />

            <!-- Basic Config Section -->
            <div style="margin-bottom: 24px">
              <h4
                style="
                  font-size: 1rem;
                  font-weight: 700;
                  margin-bottom: 16px;
                  color: #1a1a1a;
                  display: flex;
                  align-items: center;
                  gap: 8px;
                "
              >
                <svg
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <circle cx="12" cy="12" r="10" />
                  <line x1="12" y1="16" x2="12" y2="12" />
                  <line x1="12" y1="8" x2="12.01" y2="8" />
                </svg>
                Th√¥ng tin c∆° b·∫£n
              </h4>

              <div class="form-group mb-3">
                <label
                  class="form-label"
                  style="font-weight: 600; margin-bottom: 8px; display: block"
                  >T√™n c·∫•u h√¨nh *</label
                >
                <input
                  type="text"
                  id="scheduleName"
                  class="form-input"
                  required
                  placeholder="VD: B√°o c√°o tu·∫ßn g·ª≠i S·∫øp"
                />
              </div>
            </div>

            <!-- Report Config Section -->
            <div style="margin-bottom: 24px">
              <h4
                style="
                  font-size: 1rem;
                  font-weight: 700;
                  margin-bottom: 16px;
                  color: #1a1a1a;
                  display: flex;
                  align-items: center;
                  gap: 8px;
                "
              >
                <svg
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"
                  />
                  <polyline points="14 2 14 8 20 8" />
                  <line x1="16" y1="13" x2="8" y2="13" />
                  <line x1="16" y1="17" x2="8" y2="17" />
                  <polyline points="10 9 9 9 8 9" />
                </svg>
                C·∫•u h√¨nh b√°o c√°o
              </h4>

              <div class="grid grid-2 gap-3 mb-3">
                <div class="form-group">
                  <label
                    class="form-label"
                    style="font-weight: 600; margin-bottom: 8px; display: block"
                    >Lo·∫°i b√°o c√°o *</label
                  >
                  <select id="scheduleReportType" class="form-select" required>
                    <option value="general">T·ªïng h·ª£p nh√¢n s·ª±</option>
                    <option value="movement">Bi·∫øn ƒë·ªông nh√¢n s·ª±</option>
                    <option value="classifications">
                      Ph√¢n lo·∫°i / Tr√¨nh ƒë·ªô
                    </option>
                  </select>
                </div>
                <div class="form-group">
                  <label
                    class="form-label"
                    style="font-weight: 600; margin-bottom: 8px; display: block"
                    >Ph·∫°m vi d·ªØ li·ªáu</label
                  >
                  <select
                    id="scheduleDataPeriod"
                    class="form-select"
                    required
                    onchange="toggleCustomDateRange()"
                  >
                    <option value="same_day">Trong ng√†y (H√¥m nay)</option>
                    <option value="previous_day" selected>
                      H√¥m qua (H√¥m tr∆∞·ªõc)
                    </option>
                    <option value="current_week">Tu·∫ßn n√†y</option>
                    <option value="previous_week">Tu·∫ßn tr∆∞·ªõc</option>
                    <option value="current_month">Th√°ng n√†y</option>
                    <option value="previous_month">Th√°ng tr∆∞·ªõc</option>
                    <option value="custom">
                      T√πy ch·ªânh (T·ª´ ng√†y - ƒê·∫øn ng√†y)
                    </option>
                  </select>

                  <!-- Custom Date Range (Hidden by default) -->
                  <div
                    id="customDateRange"
                    class="grid grid-2 gap-2 mt-2"
                    style="display: none"
                  >
                    <div>
                      <label class="text-xs text-gray-500">T·ª´ ng√†y</label>
                      <input
                        type="date"
                        id="scheduleDateFrom"
                        class="form-input text-sm p-1"
                      />
                    </div>
                    <div>
                      <label class="text-xs text-gray-500">ƒê·∫øn ng√†y</label>
                      <input
                        type="date"
                        id="scheduleDateTo"
                        class="form-input text-sm p-1"
                      />
                    </div>
                  </div>
                </div>
              </div>

              <div class="form-group mb-3">
                <label
                  class="form-label"
                  style="font-weight: 600; margin-bottom: 8px; display: block"
                  >Ph√≤ng ban (T√πy ch·ªçn)</label
                >
                <!-- Will be populated by JS -->
                <select id="scheduleDepartment" class="form-select">
                  <option value="">T·∫•t c·∫£ ph√≤ng ban</option>
                </select>
              </div>
            </div>

            <!-- Schedule Config Section -->
            <div style="margin-bottom: 24px">
              <h4
                style="
                  font-size: 1rem;
                  font-weight: 700;
                  margin-bottom: 16px;
                  color: #1a1a1a;
                  display: flex;
                  align-items: center;
                  gap: 8px;
                "
              >
                <svg
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <circle cx="12" cy="12" r="10" />
                  <polyline points="12 6 12 12 16 14" />
                </svg>
                C·∫•u h√¨nh th·ªùi gian
              </h4>

              <div class="schedule-planner mb-4">
                <!-- Frequency Tabs -->
                <div
                  class="freq-tabs flex gap-2 mb-3"
                  style="display: flex; gap: 8px"
                >
                  <label
                    class="freq-tab"
                    style="
                      flex: 1;
                      padding: 12px;
                      border: 2px solid #e0e0e0;
                      border-radius: 6px;
                      cursor: pointer;
                      text-align: center;
                      transition: all 0.2s;
                      background: white;
                    "
                  >
                    <input
                      type="radio"
                      name="freq"
                      value="daily"
                      checked
                      onchange="toggleScheduleOptions()"
                      style="display: none"
                    />
                    <span style="font-weight: 600">H√†ng ng√†y</span>
                  </label>
                  <label
                    class="freq-tab"
                    style="
                      flex: 1;
                      padding: 12px;
                      border: 2px solid #e0e0e0;
                      border-radius: 6px;
                      cursor: pointer;
                      text-align: center;
                      transition: all 0.2s;
                      background: white;
                    "
                  >
                    <input
                      type="radio"
                      name="freq"
                      value="weekly"
                      onchange="toggleScheduleOptions()"
                      style="display: none"
                    />
                    <span style="font-weight: 600">H√†ng tu·∫ßn</span>
                  </label>
                  <label
                    class="freq-tab"
                    style="
                      flex: 1;
                      padding: 12px;
                      border: 2px solid #e0e0e0;
                      border-radius: 6px;
                      cursor: pointer;
                      text-align: center;
                      transition: all 0.2s;
                      background: white;
                    "
                  >
                    <input
                      type="radio"
                      name="freq"
                      value="monthly"
                      onchange="toggleScheduleOptions()"
                      style="display: none"
                    />
                    <span style="font-weight: 600">H√†ng th√°ng</span>
                  </label>
                </div>

                <!-- Time Picker -->
                <div class="form-group mb-3" style="margin-top: 24px">
                  <label
                    class="form-label"
                    style="font-weight: 600; margin-bottom: 8px; display: block"
                    >Gi·ªù g·ª≠i</label
                  >
                  <input
                    type="time"
                    id="scheduleTime"
                    class="form-input"
                    value="08:00"
                    style="width: 150px"
                    required
                  />
                </div>

                <!-- Weekly Specifics -->
                <div
                  id="weeklyOptions"
                  class="freq-options"
                  style="display: none"
                >
                  <label class="form-label mb-2">Ch·ªçn th·ª© trong tu·∫ßn</label>
                  <div class="week-selector flex gap-2">
                    <div class="day-btn" data-val="1" onclick="selectDay(this)">
                      T2
                    </div>
                    <div class="day-btn" data-val="2" onclick="selectDay(this)">
                      T3
                    </div>
                    <div class="day-btn" data-val="3" onclick="selectDay(this)">
                      T4
                    </div>
                    <div class="day-btn" data-val="4" onclick="selectDay(this)">
                      T5
                    </div>
                    <div class="day-btn" data-val="5" onclick="selectDay(this)">
                      T6
                    </div>
                    <div class="day-btn" data-val="6" onclick="selectDay(this)">
                      T7
                    </div>
                    <div class="day-btn" data-val="0" onclick="selectDay(this)">
                      CN
                    </div>
                  </div>
                  <input type="hidden" id="selectedWeekDay" value="1" />
                </div>

                <!-- Monthly Specifics -->
                <div
                  id="monthlyOptions"
                  class="freq-options"
                  style="display: none"
                >
                  <label class="form-label mb-2">Ch·ªçn ng√†y trong th√°ng</label>
                  <div class="month-grid grid grid-7 gap-1">
                    <!-- JS to populate 1-31? Or manual HTML for simplicity -->
                    <!-- Let's render via JS or just simple html -->
                    <script>
                      // Inline script to generate days? No, avoid inline.
                      // I will generate this HTML via this tool call.
                    </script>
                    <div class="day-btn" onclick="selectMonthDay(this, 1)">
                      1
                    </div>
                    <div class="day-btn" onclick="selectMonthDay(this, 2)">
                      2
                    </div>
                    <div class="day-btn" onclick="selectMonthDay(this, 3)">
                      3
                    </div>
                    <div class="day-btn" onclick="selectMonthDay(this, 4)">
                      4
                    </div>
                    <div class="day-btn" onclick="selectMonthDay(this, 5)">
                      5
                    </div>
                    <div class="day-btn" onclick="selectMonthDay(this, 6)">
                      6
                    </div>
                    <div class="day-btn" onclick="selectMonthDay(this, 7)">
                      7
                    </div>
                    <div class="day-btn" onclick="selectMonthDay(this, 8)">
                      8
                    </div>
                    <div class="day-btn" onclick="selectMonthDay(this, 9)">
                      9
                    </div>
                    <div class="day-btn" onclick="selectMonthDay(this, 10)">
                      10
                    </div>
                    <div class="day-btn" onclick="selectMonthDay(this, 11)">
                      11
                    </div>
                    <div class="day-btn" onclick="selectMonthDay(this, 12)">
                      12
                    </div>
                    <div class="day-btn" onclick="selectMonthDay(this, 13)">
                      13
                    </div>
                    <div class="day-btn" onclick="selectMonthDay(this, 14)">
                      14
                    </div>
                    <div class="day-btn" onclick="selectMonthDay(this, 15)">
                      15
                    </div>
                    <div class="day-btn" onclick="selectMonthDay(this, 16)">
                      16
                    </div>
                    <div class="day-btn" onclick="selectMonthDay(this, 17)">
                      17
                    </div>
                    <div class="day-btn" onclick="selectMonthDay(this, 18)">
                      18
                    </div>
                    <div class="day-btn" onclick="selectMonthDay(this, 19)">
                      19
                    </div>
                    <div class="day-btn" onclick="selectMonthDay(this, 20)">
                      20
                    </div>
                    <div class="day-btn" onclick="selectMonthDay(this, 21)">
                      21
                    </div>
                    <div class="day-btn" onclick="selectMonthDay(this, 22)">
                      22
                    </div>
                    <div class="day-btn" onclick="selectMonthDay(this, 23)">
                      23
                    </div>
                    <div class="day-btn" onclick="selectMonthDay(this, 24)">
                      24
                    </div>
                    <div class="day-btn" onclick="selectMonthDay(this, 25)">
                      25
                    </div>
                    <div class="day-btn" onclick="selectMonthDay(this, 26)">
                      26
                    </div>
                    <div class="day-btn" onclick="selectMonthDay(this, 27)">
                      27
                    </div>
                    <div class="day-btn" onclick="selectMonthDay(this, 28)">
                      28
                    </div>
                    <div class="day-btn" onclick="selectMonthDay(this, 29)">
                      29
                    </div>
                    <div class="day-btn" onclick="selectMonthDay(this, 30)">
                      30
                    </div>
                    <div class="day-btn" onclick="selectMonthDay(this, 31)">
                      31
                    </div>
                  </div>
                  <input type="hidden" id="selectedMonthDay" value="1" />
                </div>
              </div>
            </div>

            <!-- Recipients Section -->
            <div style="margin-bottom: 24px">
              <h4
                style="
                  font-size: 1rem;
                  font-weight: 700;
                  margin-bottom: 16px;
                  color: #1a1a1a;
                  display: flex;
                  align-items: center;
                  gap: 8px;
                "
              >
                <svg
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"
                  />
                  <polyline points="22,6 12,13 2,6" />
                </svg>
                Ng∆∞·ªùi nh·∫≠n
              </h4>

              <div class="form-group mb-3">
                <label
                  class="form-label"
                  style="font-weight: 600; margin-bottom: 8px; display: block"
                >
                  Email nh·∫≠n b√°o c√°o
                  <span
                    style="font-size: 0.85rem; color: #666; font-weight: 400"
                    >(C√°ch nhau b·ªüi d·∫•u ph·∫©y)</span
                  >
                </label>
                <input
                  type="text"
                  id="scheduleRecipients"
                  class="form-input"
                  required
                  placeholder="boss@company.com, admin@company.com"
                />
              </div>
            </div>

            <div
              class="modal-footer"
              style="
                border-top: 1px solid #e0e0e0;
                padding: 16px 0;
                margin-top: 8px;
              "
            >
              <button
                type="button"
                class="btn btn-outline"
                onclick="closeModal('scheduleReportModal')"
              >
                H·ªßy
              </button>
              <button type="submit" class="btn btn-primary">
                L∆∞u c·∫•u h√¨nh
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <!-- Confirmation Modal -->
    <div class="modal-overlay" id="confirmationModal">
      <div class="modal" style="max-width: 400px; animation: slideIn 0.3s ease">
        <div class="modal-header" style="color: white">
          <h3
            class="modal-title"
            style="font-size: 1.1rem; font-weight: 600"
            id="confirmTitle"
          >
            X√ÅC NH·∫¨N
          </h3>
          <button
            class="modal-close text-white"
            onclick="closeConfirmationModal()"
            style="
              color: black;
              background: none;
              border: none;
              cursor: pointer;
            "
          >
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="18" y1="6" x2="6" y2="18" />
              <line x1="6" y1="6" x2="18" y2="18" />
            </svg>
          </button>
        </div>
        <div class="modal-body" style="padding: 24px">
          <p
            id="confirmMessage"
            style="color: #333; font-size: 1rem; line-height: 1.5"
          ></p>
        </div>
        <div
          class="modal-footer"
          style="
            padding: 16px 24px;
            background: #f9fafb;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
          "
        >
          <button
            type="button"
            class="btn btn-outline"
            onclick="closeConfirmationModal()"
            style="
              padding: 10px 24px;
              text-transform: uppercase;
              font-weight: 600;
              border-radius: 4px;
            "
          >
            H·ª¶Y
          </button>
          <button
            type="button"
            class="btn btn-primary"
            id="confirmOkBtn"
            style="
              padding: 10px 24px;
              background: #dc2626;
              border-color: #dc2626;
              text-transform: uppercase;
              font-weight: 600;
              border-radius: 4px;
            "
          >
            ƒê·ªíNG √ù
          </button>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="js/api.js"></script>
    <script src="js/app.js"></script>
    <script src="js/spa-logic.js?v=3"></script>
  </body>
</html>
